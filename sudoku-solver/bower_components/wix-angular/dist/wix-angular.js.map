{"version":3,"file":"wix-angular.js","sources":["concat/wix-angular.js"],"names":["angular","module","config","$httpProvider","wixAngularTopologyProvider","interceptors","push","getStaticsUrl","setStaticsUrl","element","document","find","attr","constant","LOGGED_OUT","NOT_FOUND","RUNTIME_EXCEPTION","SERVER_ERROR","QUOTA_EXCEEDED","WixAngularStorageController","wixCache","wixStorage","that","this","getOptions","siteId","noCache","writeData","res","data","eraseData","cache","set","key","setWithGUID","then","get","remove","remote","value","$inject","controller","wixTranslateCompile","$translate","$compile","$parse","restrict","replace","link","scope","attrs","values","translateValues","content","html","contents","directive","relativeHref","wixAngularTopology","priority","$observe","url","$set","staticsUrl","relativeSrc","indexOf","hookPreLink","fn","pre","post","hooked","apply","undefined","arguments","wixManagersNgDirective","manager","ngDirective","directiveName","ngAttributeName","parseNegation","expr","negationGroups","exec","negation","name","contains","length","ngDir","ddo","copy","compile","ret","defineNgDirective","$injector","invoke","experimentManager","ngIfDirective","permissionsManager","ngDisabledDirective","wixManagersClass","valuesToCheck","postLink","classToAdd","addClass","defineClassDirective","wixAngularInterceptorFactory","$q","wixCookies","$rootScope","wixAngularEvents","wixAngularInterceptor","firstUserSwitchTest","previousUserGUID","errorHandler","response","reject","checkUserSwitch","userGUID","$emit","userSwitch","request","match","calcPartialsUrl","fixOrigin","success","status","payload","responseError","factory","WixAngular","experimentManagerProvider","isExperimentEnabled","bind","setExperiments","$get","wixAngular","experiments","$$getExperimentsObj","partialsUrl","provider","wixCacheFactory","recordUtils","crossStorage","wixAngularStorageErrors","DEFAULT_AGE_IN_SEC","DATA_TYPE","ADHOC_TYPE","REMOTE_TYPE","CLEAN_EPSILON","rejectWithRuntimeException","getCrossStorage","onConnect","catch","tryToSet","cacheKey","getCacheKey","options","returnKey","reason","type","clear","getRecordSize","validateKey","validateData","validateExpiration","createdAt","Date","now","extend","expiration","generateRandomKey","opts","record","isExpired","del","isUserLoggedIn","wixCookiesFactory","cookieStr","parsedUser","prevCookies","parseUserCookie","cookie","cookieParts","split","guid","userName","parseAllCookies","cookies","map","str","trim","reduce","acc","curr","args","getParsedUserCookie","wixClient",{"end":{"file":"concat/wix-angular.js","comments_before":[],"nlb":false,"endpos":16994,"endcol":18,"endline":544,"pos":16986,"col":10,"line":544,"value":"userGUID","type":"name"},"start":{"file":"concat/wix-angular.js","comments_before":[],"nlb":false,"endpos":16994,"endcol":18,"endline":544,"pos":16986,"col":10,"line":544,"value":"userGUID","type":"name"},"name":"userGUID"},"$document","LOCAL_STORAGE_FRAME_ID","promiseCtor","resolver","dfd","defer","resolve","promise","when","CrossStorageClient","prototype","amount","_request","frameId","crossStorageCleanerFactory","$window","$interval","MAX_STORAGE_SIZE_IN_BYTES","CLEANING_INTERVAL","hub","CrossStorageHub","init","_set","dataKeys","remoteAndAdhocKeys","removeFromArray","item","arr","itemIndex","splice","chooseArrayByType","clearRecord","_get","keys","recordSize","_del","clearRecords","getWixCacheKeys","_getKeys","filter","hasPrefix","getWixCacheSize","loadExistingWixCacheKeys","createdAtSort","a","b","getKey","forEach","sort","decorateInit","permissions","_clear","decorateSet","params","clearOtherUsers","belongsToCurrentUser","clearExpiredRecords","clearNonExpiredRecord","shift","requiredSpace","clearedSpace","size","removedRecordsSpace","removed","origin","allow","run","wixStorageFactory","$http","ANGULAR_STORAGE_PREFIX","cacheRemoteData","getRemote","path","identity","join","err","tryCache","dto","nameSpace","blob","TTLInDays","Math","ceil","recordUtilsFactory","KEY_SEPARATOR","MAX_KEY_LENGTH","MAX_VALUE_SIZE_IN_BYTES","MAX_AGE_IN_SEC","countBytes","encodeURI","hasExpiration","Error","val","JSON","stringify","random","toString","slice","WixAngularTopology","$sceDelegateProvider","location","protocol","resourceUrlWhitelist","$location","host","force","has","window","jsonpExperiemts","loadExperimentScopeSync","write","setExperimentsSync","junk","ExperimentManager","petriUrlPrefix","getExperimentValue","loadScope","_this","$$queryPetri","loadExperiment","fallback","singleExperiment","getPetriUrl","getQueryParams","result","ExperimentManagerProvider","clearExperiments","instantiate","beforeEach","$provide","decorator","$delegate","originalGetExperimentValue","originalIsExperimentEnabled","scopeToExperiments","unexpected","used","addIfNotExist","group","markAsUsedOrUnexpected","experiment","resolvePromise","deferred","Object","prev","setScopeExperiments","verifyNoUnexpectedExperiments","verifyNoUnusedExperiments","unused","PermissionsManager","getIndexOf","PermissionsManagerProvider","setPermissions","clearPermissions"],"mappings":"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","sourcesContent":["\n/// <reference path=\"reference.ts\" />\n/* global document */\n'use strict';\nangular.module('wixAngularExperiments', []);\nangular.module('wixAngularPermissions', []);\nangular.module('wixAngularBackwardCompatibility', ['wixAngularAppInternal', 'wixAngularExperiments']);\nangular.module('wixAngularStorage', ['wixAngularAppInternal']);\nangular.module('wixAngularStorageHub', ['wixAngularStorage']);\nangular.module('wixAngularAppInternal', []);\nangular.module('wixAngularInterceptor', ['wixAngularAppInternal']).config([\"$httpProvider\", \"wixAngularTopologyProvider\", function ($httpProvider, wixAngularTopologyProvider) {\n    $httpProvider.interceptors.push('wixAngularInterceptor');\n    if (!wixAngularTopologyProvider.getStaticsUrl()) {\n        wixAngularTopologyProvider.setStaticsUrl(angular.element(document).find('base').attr('href'));\n    }\n}]);\nangular.module('wixAngularTranslateCompile', ['pascalprecht.translate']);\nangular.module('wixAngular', ['wixAngularAppInternal', 'wixAngularTranslateCompile', 'wixAngularStorage', 'wixAngularExperiments', 'wixAngularInterceptor', 'wixAngularBackwardCompatibility', 'wixAngularPermissions']);\n\n'use strict';\nangular\n  .module('wixAngularStorage')\n  .constant('ANGULAR_STORAGE_PREFIX', 'wixAngularStorage')\n  .constant('KEY_SEPARATOR', '|')\n  .constant('DEFAULT_AGE_IN_SEC', 60 * 60)\n  .constant('CLEANING_INTERVAL', 1000 * 60 * 10)\n  .constant('CLEAN_EPSILON', 100)\n  .constant('MAX_KEY_LENGTH', 100)\n  .constant('MAX_VALUE_SIZE_IN_BYTES', 4 * 1024)\n  .constant('MAX_AGE_IN_SEC', 60 * 60 * 24 * 2)\n  .constant('MAX_STORAGE_SIZE_IN_BYTES', 1024 * 1024)\n  .constant('DATA_TYPE', 'data')\n  .constant('ADHOC_TYPE', 'adhoc')\n  .constant('REMOTE_TYPE', 'remote')\n  .constant('LOCAL_STORAGE_FRAME_ID', 'wixCacheFrame')\n  .constant('wixAngularStorageErrors', {\n    LOGGED_OUT: 1,\n    NOT_FOUND: 2,\n    RUNTIME_EXCEPTION: 3,\n    SERVER_ERROR: 4,\n    QUOTA_EXCEEDED: 5\n  });\n\n'use strict';\n\n(function () {\n\n  /* @ngInject */\n  function WixAngularStorageController(wixCache, wixStorage) {\n    var that = this;\n\n    function getOptions() {\n      return {\n        siteId: that.siteId,\n        noCache: that.noCache\n      };\n    }\n\n    var writeData = function (res) {\n      that.data = res;\n    };\n\n    var eraseData = function () {\n      that.data = null;\n    };\n\n    this.cache = {\n      set: function (key, data) {\n        wixCache.set(key, data, getOptions());\n      },\n      setWithGUID: function (data) {\n        wixCache.setWithGUID(data).then(function (key) {\n          that.key = key;\n        });\n      },\n      get: function (key) {\n        wixCache.get(key, getOptions()).then(writeData, eraseData);\n      },\n      remove: function (key) {\n        wixCache.remove(key, getOptions()).then(eraseData);\n      }\n    };\n\n    this.remote = {\n      set: function (key, value) {\n        wixStorage.set(key, value, getOptions());\n      },\n      get: function (key) {\n        wixStorage.get(key, getOptions()).then(writeData, eraseData);\n      },\n      remove: function (key) {\n        wixStorage.remove(key, getOptions()).then(eraseData);\n      }\n    };\n\n  }\n  WixAngularStorageController.$inject = [\"wixCache\", \"wixStorage\"];\n\n  angular\n    .module('wixAngularAppInternal')\n    .controller('WixAngularStorageController', WixAngularStorageController);\n\n})();\n\n'use strict';\n\n(function () {\n\n  /* @ngInject */\n  function wixTranslateCompile($translate, $compile, $parse) {\n    return {\n      restrict: 'A',\n      replace: true,\n      link: function (scope, element, attrs) {\n        var values = attrs.translateValues ? $parse(attrs.translateValues)(scope) : {};\n        var content = $translate(attrs.wixTranslateCompile, values);\n        element.html(content);\n        $compile(element.contents())(scope);\n      }\n    };\n  }\n  wixTranslateCompile.$inject = [\"$translate\", \"$compile\", \"$parse\"];\n\n  angular\n    .module('wixAngularTranslateCompile')\n    .directive('wixTranslateCompile', wixTranslateCompile);\n\n})();\n\n'use strict';\n\n(function () {\n\n  /* @ngInject */\n  function relativeHref(wixAngularTopology) {\n    return {\n      priority: 99, // it needs to run after the attributes are interpolated\n      link: function (scope, element, attr) {\n        attr.$observe('relativeHref', function (url) {\n          if (url) {\n            attr.$set('href', wixAngularTopology.staticsUrl + url);\n          }\n        });\n      }\n    };\n  }\n  relativeHref.$inject = [\"wixAngularTopology\"];\n\n  angular\n    .module('wixAngularAppInternal')\n    .directive('relativeHref', relativeHref);\n\n})();\n\n'use strict';\n\n(function () {\n\n  /* @ngInject */\n  function relativeSrc(wixAngularTopology) {\n    return {\n      priority: 99, // it needs to run after the attributes are interpolated\n      link: function (scope, element, attr) {\n        attr.$observe('relativeSrc', function (url) {\n          if (url) {\n            attr.$set('src', url.indexOf('images/') === 0 ? wixAngularTopology.staticsUrl + url : url);\n          }\n        });\n      }\n    };\n  }\n  relativeSrc.$inject = [\"wixAngularTopology\"];\n\n  angular\n    .module('wixAngularAppInternal')\n    .directive('relativeSrc', relativeSrc);\n\n})();\n\n'use strict';\n\n(function () {\n\n  function hookPreLink(link, fn) {\n    if (typeof link === 'function') {\n      return {pre: fn, post: link};\n    } else {\n      var hooked = link.pre;\n      link.pre = function () {\n        fn.apply(undefined, arguments);\n        return hooked.apply(undefined, arguments);\n      };\n      return link;\n    }\n  }\n\n  /* @ngInject */\n  function wixManagersNgDirective(manager, ngDirective, directiveName, ngAttributeName) {\n    function parseNegation(expr) {\n      var negationGroups = /^(\\!*)([^!].*)/.exec(expr);\n      var negation = negationGroups[1];\n      var name = negationGroups[2];\n      var value = manager.contains(name);\n      return negation.length % 2 ? !value : value;\n    }\n\n    var ngDir = ngDirective[0];\n    var ddo = angular.copy(ngDir);\n    ddo.compile = function () {\n      var ret = ngDir.compile.apply(ngDir, arguments);\n      return hookPreLink(ret, function (scope, element, attr) {\n        attr[ngAttributeName] = function () {\n          var expr = attr[directiveName];\n          return parseNegation(expr);\n        };\n      });\n    };\n    return ddo;\n  }\n  wixManagersNgDirective.$inject = [\"manager\", \"ngDirective\", \"directiveName\", \"ngAttributeName\"];\n\n  function defineNgDirective($injector, manager, name, ngDirective, ngAttributeName) {\n    /*jshint validthis:true */\n    return $injector.invoke(wixManagersNgDirective, this, {manager: manager, directiveName: name, ngDirective: ngDirective, ngAttributeName: ngAttributeName});\n    /*jshint validthis:false */\n  }\n\n  angular\n    .module('wixAngularExperiments')\n    .directive('wixExperimentIf', [\"$injector\", \"experimentManager\", \"ngIfDirective\", function ($injector, experimentManager, ngIfDirective) {\n      return defineNgDirective($injector, experimentManager, 'wixExperimentIf', ngIfDirective, 'ngIf');\n    }]);\n  angular\n    .module('wixAngularPermissions')\n    .directive('wixPermissionIf', [\"$injector\", \"permissionsManager\", \"ngIfDirective\", function ($injector, permissionsManager, ngIfDirective) {\n      return defineNgDirective($injector, permissionsManager, 'wixPermissionIf', ngIfDirective, 'ngIf');\n    }]);\n  angular\n    .module('wixAngularExperiments')\n    .directive('wixExperimentDisabled', [\"$injector\", \"experimentManager\", \"ngDisabledDirective\", function ($injector, experimentManager, ngDisabledDirective) {\n      return defineNgDirective($injector, experimentManager, 'wixExperimentDisabled', ngDisabledDirective, 'ngDisabled');\n    }]);\n  angular\n    .module('wixAngularPermissions')\n    .directive('wixPermissionDisabled', [\"$injector\", \"permissionsManager\", \"ngDisabledDirective\", function ($injector, permissionsManager, ngDisabledDirective) {\n      return defineNgDirective($injector, permissionsManager, 'wixPermissionDisabled', ngDisabledDirective, 'ngDisabled');\n    }]);\n})();\n\n'use strict';\n\n(function () {\n\n  /* @ngInject */\n  function wixManagersClass(manager, directiveName, valuesToCheck, $parse) {\n    return {\n      restrict: 'A',\n      link: function postLink(scope, element, attr) {\n        var values = $parse(attr[valuesToCheck])(scope);\n        var name = attr[directiveName];\n\n        if (values) {\n          var classToAdd = values[manager.get(name)];\n          if (classToAdd) {\n            element.addClass(classToAdd);\n          }\n        }\n      }\n    };\n  }\n  wixManagersClass.$inject = [\"manager\", \"directiveName\", \"valuesToCheck\", \"$parse\"];\n\n  function defineClassDirective($injector, manager, name, valuesToCheck) {\n    /*jshint validthis:true */\n    return $injector.invoke(wixManagersClass, this, {manager: manager, directiveName: name, valuesToCheck: valuesToCheck});\n    /*jshint validthis:false */\n  }\n\n  angular\n    .module('wixAngularExperiments')\n    .directive('wixExperimentClass', [\"$injector\", \"experimentManager\", function ($injector, experimentManager) {\n      return defineClassDirective($injector, experimentManager, 'wixExperimentClass', 'experimentValues');\n    }]);\n  angular\n    .module('wixAngularPermissions')\n    .directive('wixPermissionClass', [\"$injector\", \"permissionsManager\", function ($injector, permissionsManager) {\n      return defineClassDirective($injector, permissionsManager, 'wixPermissionClass', 'permissionValues');\n    }]);\n})();\n\n'use strict';\n\n(function () {\n\n  /* @ngInject */\n  function wixAngularInterceptorFactory($q, wixCookies, $rootScope, wixAngularEvents, wixAngularTopology) {\n    var wixAngularInterceptor = {};\n    var firstUserSwitchTest = true;\n    var previousUserGUID;\n\n    function errorHandler(response) {\n      // TBD: send to BI\n      //$log.error(response);\n      return $q.reject(response);\n    }\n\n    function checkUserSwitch() {\n      if (!firstUserSwitchTest && previousUserGUID !== wixCookies.userGUID) {\n        //this is kind of a hack, we emit cuz we want widgets to pass it to their parents\n        $rootScope.$emit(wixAngularEvents.userSwitch, wixCookies.userGUID, previousUserGUID);\n      }\n      previousUserGUID = wixCookies.userGUID;\n      firstUserSwitchTest = false;\n    }\n\n    wixAngularInterceptor.request = function (config) {\n      checkUserSwitch();\n      if (config.url.match(/\\.html$/)) {\n        if (!config.url.match(/(:|^)\\/\\//)) {\n          if (!config.cache || !config.cache.get || !config.cache.get(config.url)) {\n            config.url = wixAngularTopology.calcPartialsUrl(wixAngularTopology.staticsUrl) + config.url.replace(/^\\//, '');\n          }\n        }\n      } else if (config.url.indexOf('/_api/') === 0) {\n        config.url = wixAngularTopology.fixOrigin(config.url);\n      }\n      return config;\n    };\n\n    wixAngularInterceptor.response = function (response) {\n      if (response.data) {\n        if (response.data.success === false) {\n          response.status = 500;\n          return errorHandler(response);\n        } else if (response.data.success === true && response.data.payload !== undefined) {\n          response.data = response.data.payload;\n        }\n      }\n      return response;\n    };\n\n    wixAngularInterceptor.responseError = function (response) {\n      return errorHandler(response);\n    };\n\n    return wixAngularInterceptor;\n  }\n  wixAngularInterceptorFactory.$inject = [\"$q\", \"wixCookies\", \"$rootScope\", \"wixAngularEvents\", \"wixAngularTopology\"];\n\n  angular\n    .module('wixAngularAppInternal')\n    .factory('wixAngularInterceptor', wixAngularInterceptorFactory)\n    .constant('wixAngularEvents', {\n      userSwitch: 'userSwitch'\n    });\n\n})();\n\n'use strict';\n\n(function () {\n\n  /* @ngInject */\n  function WixAngular(wixAngularTopologyProvider, experimentManagerProvider) {\n\n    this.getStaticsUrl = wixAngularTopologyProvider.getStaticsUrl;\n    this.setStaticsUrl = wixAngularTopologyProvider.setStaticsUrl;\n\n    var isExperimentEnabled = experimentManagerProvider.isExperimentEnabled.bind(experimentManagerProvider);\n    this.setExperiments = experimentManagerProvider.setExperiments.bind(experimentManagerProvider);\n    this.isExperimentEnabled = isExperimentEnabled;\n\n    /* @ngInject */\n    this.$get = [\"wixAngularTopology\", \"experimentManager\", function (wixAngularTopology, experimentManager) {\n      var wixAngular = {};\n\n      wixAngular.experiments = experimentManager.$$getExperimentsObj();\n      wixAngular.isExperimentEnabled = isExperimentEnabled;\n\n      wixAngular.fixOrigin = wixAngularTopology.fixOrigin;\n      wixAngular.staticsUrl = wixAngularTopology.staticsUrl;\n      wixAngular.partialsUrl = wixAngularTopology.partialsUrl;\n\n      return wixAngular;\n    }];\n    this.$get.$inject = [\"wixAngularTopology\", \"experimentManager\"];\n  }\n  WixAngular.$inject = [\"wixAngularTopologyProvider\", \"experimentManagerProvider\"];\n\n  angular\n    .module('wixAngularBackwardCompatibility')\n    .provider('wixAngular', WixAngular);\n\n})();\n\n'use strict';\n\n(function () {\n\n  /* @ngInject */\n  function wixCacheFactory($q, recordUtils, crossStorage, wixAngularStorageErrors,\n                           DEFAULT_AGE_IN_SEC, DATA_TYPE, ADHOC_TYPE, REMOTE_TYPE, CLEAN_EPSILON) {\n\n    var wixCache = {};\n\n    function rejectWithRuntimeException() {\n      return $q.reject(wixAngularStorageErrors.RUNTIME_EXCEPTION);\n    }\n\n    function getCrossStorage() {\n      return crossStorage.onConnect()\n        .catch(rejectWithRuntimeException);\n    }\n\n    function tryToSet(key, value) {\n      var cacheKey = recordUtils.getCacheKey(key, value.options);\n\n      function returnKey() {\n        return key;\n      }\n\n      return getCrossStorage()\n        .then(function () {\n          return crossStorage.set(cacheKey, value);\n        })\n        .then(returnKey, function (reason) {\n          if (reason === wixAngularStorageErrors.RUNTIME_EXCEPTION) {\n            return rejectWithRuntimeException();\n          }\n          if (value.options.type === REMOTE_TYPE) {\n            return $q.reject();\n          } else {\n            return crossStorage.clear(recordUtils.getRecordSize(cacheKey, value) + CLEAN_EPSILON)\n              .then(function () {\n                return crossStorage.set(cacheKey, value).then(returnKey, rejectWithRuntimeException);\n              }, function () {\n                return $q.reject(wixAngularStorageErrors.QUOTA_EXCEEDED);\n              });\n          }\n        });\n    }\n\n    wixCache.set = function (key, data, options) {\n      recordUtils.validateKey(key);\n      recordUtils.validateData(data);\n      recordUtils.validateExpiration(options);\n\n      var value = {\n        createdAt: Date.now(),\n        data: data,\n        options: angular.extend({\n          expiration: DEFAULT_AGE_IN_SEC,\n          type: DATA_TYPE\n        }, options)\n      };\n\n      return tryToSet(key, value);\n    };\n\n    wixCache.setWithGUID = function (data) {\n      var key = recordUtils.generateRandomKey();\n      return this.set(key, data, {\n        expiration: null,\n        type: ADHOC_TYPE\n      });\n    };\n\n    wixCache.get = function (key, opts) {\n      return getCrossStorage()\n        .then(function () {\n          return crossStorage.get(recordUtils.getCacheKey(key, opts));\n        })\n        .then(function (record) {\n          if (record && !recordUtils.isExpired(record)) {\n            return record.data;\n          } else {\n            return $q.reject(wixAngularStorageErrors.NOT_FOUND);\n          }\n        }, rejectWithRuntimeException);\n    };\n\n    wixCache.remove = function (key, opts) {\n      return getCrossStorage()\n        .then(function () {\n          return crossStorage.del(recordUtils.getCacheKey(key, opts));\n        })\n        .catch(rejectWithRuntimeException);\n    };\n\n    if (!recordUtils.isUserLoggedIn()) {\n      wixCache.set = wixCache.get = wixCache.remove = function () {\n        return $q.reject(wixAngularStorageErrors.LOGGED_OUT);\n      };\n    }\n\n    return wixCache;\n  }\n  wixCacheFactory.$inject = [\"$q\", \"recordUtils\", \"crossStorage\", \"wixAngularStorageErrors\", \"DEFAULT_AGE_IN_SEC\", \"DATA_TYPE\", \"ADHOC_TYPE\", \"REMOTE_TYPE\", \"CLEAN_EPSILON\"];\n\n  angular\n    .module('wixAngularStorage')\n    .factory('wixCache', wixCacheFactory);\n})();\n\n'use strict';\n\n(function () {\n\n  /* @ngInject */\n  function wixCookiesFactory(cookieStr) {\n\n    var parsedUser, prevCookies;\n\n    function parseUserCookie(cookie) {\n      var cookieParts = cookie ? cookie.split('|') : [];\n      return {\n        guid: cookieParts[6],\n        userName: cookieParts[0]\n      };\n    }\n\n    function parseAllCookies(cookies) {\n      return cookies.split(';')\n        .map(function (str) {\n          return str.trim();\n        })\n        .reduce(function (acc, curr) {\n          var args = curr.split('=');\n          acc[args[0]] = args[1];\n          return acc;\n        }, {});\n    }\n\n    function getParsedUserCookie() {\n      var cookies = cookieStr() || '';\n      if (cookies !== prevCookies) {\n        prevCookies = cookies;\n        parsedUser = parseUserCookie(parseAllCookies(cookies).wixClient);\n      }\n      return parsedUser;\n    }\n\n    return {\n      get userGUID() {\n        return getParsedUserCookie().guid;\n      },\n\n      get userName() {\n        return getParsedUserCookie().userName;\n      }\n    };\n  }\n  wixCookiesFactory.$inject = [\"cookieStr\"];\n\n  angular\n    .module('wixAngularAppInternal')\n    .factory('wixCookies', wixCookiesFactory)\n    .factory('cookieStr', [\"$document\", function ($document) {\n      return function () {\n        return ($document[0] && $document[0].cookie) || '';\n      };\n    }]);\n\n})();\n\n/* global CrossStorageClient */\n'use strict';\n\n(function () {\n\n  /* @ngInject */\n  function crossStorage($q, wixAngularTopology, LOCAL_STORAGE_FRAME_ID) {\n\n    function promiseCtor(resolver) {\n      var dfd = $q.defer();\n      resolver(dfd.resolve, dfd.reject);\n      return dfd.promise;\n    }\n\n    promiseCtor.resolve = function () {\n      return $q.when(true);\n    };\n    promiseCtor.reject = $q.reject;\n\n    CrossStorageClient.prototype.clear = function (amount) {\n      return this._request('clear', {\n        amount: amount\n      });\n    };\n    return new CrossStorageClient(wixAngularTopology.staticsUrl\n      .replace('.parastaging.com', '.wixpress.com')\n      .replace('.parastorage.com', '.wix.com')\n      .replace('//static.', '//sslstatic.') +\n      'bower_components/wix-angular/dist/views/cross-storage.html', {\n      frameId: LOCAL_STORAGE_FRAME_ID,\n      promise: promiseCtor\n    });\n  }\n  crossStorage.$inject = [\"$q\", \"wixAngularTopology\", \"LOCAL_STORAGE_FRAME_ID\"];\n\n  angular\n    .module('wixAngularStorage')\n    .factory('crossStorage', crossStorage);\n\n})();\n\n'use strict';\n\n(function () {\n\n  /* @ngInject */\n  function crossStorageCleanerFactory($window, $interval, recordUtils, MAX_STORAGE_SIZE_IN_BYTES,\n                                      CLEANING_INTERVAL, DATA_TYPE) {\n\n    var hub = $window.CrossStorageHub;\n    var init = hub.init;\n    var _set = hub._set;\n\n    var dataKeys = [];\n    var remoteAndAdhocKeys = [];\n\n    function removeFromArray(item, arr) {\n      var itemIndex = arr.indexOf(item);\n      if (itemIndex !== -1) {\n        arr.splice(itemIndex, 1);\n      }\n    }\n\n    function chooseArrayByType(options) {\n      return options.type === DATA_TYPE ? dataKeys : remoteAndAdhocKeys;\n    }\n\n    function clearRecord(key) {\n      var record = hub._get({keys: [key]});\n      if (record) {\n        var recordSize = recordUtils.getRecordSize(key, record);\n        hub._del({keys: [key]});\n        return recordSize;\n      } else {\n        return 0;\n      }\n    }\n\n    function clearRecords(keys) {\n      return keys.reduce(function (acc, key) {\n        acc += clearRecord(key);\n        return acc;\n      }, 0);\n    }\n\n    function getWixCacheKeys() {\n      return hub._getKeys().filter(recordUtils.hasPrefix);\n    }\n\n    function getWixCacheSize() {\n      return getWixCacheKeys().reduce(function (acc, key) {\n        return acc + recordUtils.getRecordSize(key, hub._get({keys: [key]}));\n      }, 0);\n    }\n\n    function loadExistingWixCacheKeys() {\n      var createdAtSort = function (a, b) {\n        return a.createdAt - b.createdAt;\n      };\n      var getKey = function (item) {\n        return item.key;\n      };\n      getWixCacheKeys()\n        .forEach(function (key) {\n          var item = hub._get({keys: [key]});\n          var arr = chooseArrayByType(item.options);\n          arr.push({\n            key: key,\n            createdAt: item.createdAt\n          });\n        });\n      dataKeys.sort(createdAtSort);\n      remoteAndAdhocKeys.sort(createdAtSort);\n\n      dataKeys = dataKeys.map(getKey);\n      remoteAndAdhocKeys = remoteAndAdhocKeys.map(getKey);\n    }\n\n    function decorateInit(permissions) {\n      dataKeys.length = 0;\n      remoteAndAdhocKeys.length = 0;\n      loadExistingWixCacheKeys();\n      hub._clear();\n      init(permissions);\n      $interval(hub._clear.bind(hub), CLEANING_INTERVAL);\n    }\n\n    function decorateSet(params) {\n      var arr = chooseArrayByType(params.value.options);\n      removeFromArray(params.key, arr);\n      arr.push(params.key);\n      _set(params);\n    }\n\n    function clearOtherUsers() {\n      return clearRecords(getWixCacheKeys()\n        .filter(function (key) {\n          return !recordUtils.belongsToCurrentUser(key);\n        }));\n    }\n\n    function clearExpiredRecords() {\n      return clearRecords(getWixCacheKeys()\n        .filter(function (cacheKey) {\n          var record = hub._get({keys: [cacheKey]});\n          return recordUtils.isExpired(record);\n        }));\n    }\n\n    function clearNonExpiredRecord() {\n      var arr = (remoteAndAdhocKeys.length === 0) ? dataKeys : remoteAndAdhocKeys;\n      var key = arr.shift();\n      return clearRecord(key);\n    }\n\n    hub._clear = function (amount) {\n      var requiredSpace = amount || 0;\n      var clearedSpace = 0;\n\n      clearedSpace += clearOtherUsers();\n      clearedSpace += clearExpiredRecords();\n\n      var size = getWixCacheSize();\n      var removedRecordsSpace = 0;\n      while (size - removedRecordsSpace > MAX_STORAGE_SIZE_IN_BYTES) {\n        var removed = clearNonExpiredRecord();\n        clearedSpace += removed;\n        removedRecordsSpace += removed;\n      }\n\n      if (size - removedRecordsSpace < requiredSpace - clearedSpace) {\n        return false;\n      }\n\n      while (clearedSpace < requiredSpace) {\n        clearedSpace += clearNonExpiredRecord();\n      }\n      return true;\n    };\n\n    hub.init = decorateInit;\n    hub._set = decorateSet;\n    hub.init([\n      { origin: /\\.(wix|wixpress)\\.com($|:\\d{4}$)/, allow: ['get', 'set', 'del'] },\n      { origin: /localhost:\\d{4}$/, allow: ['get', 'set', 'del'] }\n    ]);\n  }\n  crossStorageCleanerFactory.$inject = [\"$window\", \"$interval\", \"recordUtils\", \"MAX_STORAGE_SIZE_IN_BYTES\", \"CLEANING_INTERVAL\", \"DATA_TYPE\"];\n\n  angular\n    .module('wixAngularStorageHub')\n    .run(crossStorageCleanerFactory);\n\n})();\n\n'use strict';\n\n(function () {\n\n  /* @ngInject */\n  function wixStorageFactory($q, $http, recordUtils, wixCache, wixAngularStorageErrors,\n                             ANGULAR_STORAGE_PREFIX, REMOTE_TYPE, DEFAULT_AGE_IN_SEC) {\n\n    var wixStorage = {};\n\n    function cacheRemoteData(key, data, options) {\n      if (!options.noCache) {\n        return wixCache.set(key, data, angular.extend({}, options, {\n          type: REMOTE_TYPE,\n          expiration: DEFAULT_AGE_IN_SEC\n        }));\n      }\n    }\n\n    function getRemote(key, options) {\n      var path = (options.siteId) ? 'getVolatilePrefForSite' : 'getVolatilePrefForKey';\n      var url = ['/_api/wix-user-preferences-webapp', path,\n        ANGULAR_STORAGE_PREFIX, options.siteId, key]\n        .filter(angular.identity)\n        .join('/');\n\n      return $http.get(url).then(function (res) {\n        if (res.data[key] === null) {\n          return $q.reject(wixAngularStorageErrors.NOT_FOUND);\n        }\n        cacheRemoteData(key, res.data[key], options);\n        return res.data[key];\n      }, function (err) {\n        if (err.status === 404) {\n          cacheRemoteData(key, null, options);\n          return $q.reject(wixAngularStorageErrors.NOT_FOUND);\n        }\n        return $q.reject(wixAngularStorageErrors.SERVER_ERROR);\n      });\n    }\n\n    function tryCache(key, options) {\n      return wixCache.get(key, options).then(function (res) {\n        if (res === null) {\n          return $q.reject(wixAngularStorageErrors.NOT_FOUND);\n        }\n        return res;\n      }, function () {\n        return getRemote(key, options);\n      });\n    }\n\n    wixStorage.set = function (key, data, opts) {\n      var options = opts || {};\n      recordUtils.validateKey(key);\n      recordUtils.validateData(data);\n      recordUtils.validateExpiration(options);\n\n      var dto = {\n        nameSpace: ANGULAR_STORAGE_PREFIX,\n        key: key,\n        blob: data\n      };\n      if (options.siteId) {\n        dto.siteId = options.siteId;\n      }\n      if (options.expiration) {\n        dto.TTLInDays = Math.ceil(options.expiration / (60 * 60 * 24));\n      }\n      return $http.post('/_api/wix-user-preferences-webapp/set', dto).then(function () {\n        cacheRemoteData(key, data, options);\n        return key;\n      });\n    };\n\n    wixStorage.get = function (key, opts) {\n      var options = opts || {};\n      return (!options.noCache) ? tryCache(key, options) : getRemote(key, options);\n    };\n\n    wixStorage.remove = function (key, opts) {\n      return wixStorage.set(key, null, opts);\n    };\n\n    if (!recordUtils.isUserLoggedIn()) {\n      wixStorage.set = wixStorage.get = wixStorage.remove = function () {\n        return $q.reject(wixAngularStorageErrors.LOGGED_OUT);\n      };\n    }\n\n    return wixStorage;\n  }\n  wixStorageFactory.$inject = [\"$q\", \"$http\", \"recordUtils\", \"wixCache\", \"wixAngularStorageErrors\", \"ANGULAR_STORAGE_PREFIX\", \"REMOTE_TYPE\", \"DEFAULT_AGE_IN_SEC\"];\n\n  angular\n    .module('wixAngularStorage')\n    .factory('wixStorage', wixStorageFactory);\n\n})();\n\n'use strict';\n\n(function () {\n\n  /* @ngInject */\n  function recordUtilsFactory(\n    wixCookies,\n    ANGULAR_STORAGE_PREFIX,\n    KEY_SEPARATOR,\n    MAX_KEY_LENGTH, MAX_VALUE_SIZE_IN_BYTES, MAX_AGE_IN_SEC\n  ) {\n\n    var recordUtils = {};\n\n    function countBytes(str) {\n      return encodeURI(str).match(/%..|./g).length;\n    }\n\n    function hasExpiration(options) {\n      return options && !!options.expiration;\n    }\n\n    recordUtils.isUserLoggedIn = function () {\n      return wixCookies.userGUID !== undefined;\n    };\n\n    recordUtils.validateKey = function (key) {\n      if (typeof key !== 'string' || key.length > MAX_KEY_LENGTH) {\n        throw new Error('Key length should be no more than ' + MAX_KEY_LENGTH + ' chars');\n      }\n    };\n\n    recordUtils.validateData = function (data) {\n      var val = JSON.stringify(data);\n      if (countBytes(val) > MAX_VALUE_SIZE_IN_BYTES) {\n        throw new Error('The size of passed data exceeds the allowed ' +\n                        MAX_VALUE_SIZE_IN_BYTES / 1024 + ' KB');\n      }\n    };\n\n    recordUtils.validateExpiration = function (options) {\n      if (hasExpiration(options) &&\n        (typeof options.expiration !== 'number' || options.expiration > MAX_AGE_IN_SEC)) {\n        throw new Error('Expiration should be a number and cannot increase ' + MAX_AGE_IN_SEC + ' seconds');\n      }\n    };\n\n    recordUtils.isExpired = function (record) {\n      if (hasExpiration(record.options)) {\n        return record.createdAt + record.options.expiration * 1000 <= Date.now();\n      } else {\n        return false;\n      }\n    };\n\n    recordUtils.getRecordSize = function (key, value) {\n      return countBytes(key) + countBytes(JSON.stringify(value));\n    };\n\n    recordUtils.getCacheKey = function (key, opts) {\n      var options = opts || {};\n      return [ANGULAR_STORAGE_PREFIX, wixCookies.userGUID, options.siteId, key]\n        .filter(angular.identity)\n        .join(KEY_SEPARATOR);\n    };\n\n    recordUtils.generateRandomKey = function () {\n      return Math.random().toString(36).slice(2);\n    };\n\n    recordUtils.hasPrefix = function (key) {\n      return key.indexOf(ANGULAR_STORAGE_PREFIX) === 0;\n    };\n\n    recordUtils.belongsToCurrentUser = function (key) {\n      if (recordUtils.isUserLoggedIn()) {\n        return key.split(KEY_SEPARATOR)[1] === wixCookies.userGUID;\n      } else {\n        return false;\n      }\n    };\n\n    return recordUtils;\n  }\n  recordUtilsFactory.$inject = [\"wixCookies\", \"ANGULAR_STORAGE_PREFIX\", \"KEY_SEPARATOR\", \"MAX_KEY_LENGTH\", \"MAX_VALUE_SIZE_IN_BYTES\", \"MAX_AGE_IN_SEC\"];\n\n  angular\n    .module('wixAngularStorage')\n    .factory('recordUtils', recordUtilsFactory);\n})();\n\n/* global location */\n'use strict';\n\n(function () {\n\n  /* @ngInject */\n  function WixAngularTopology($sceDelegateProvider) {\n    var staticsUrl = '';\n\n    this.getStaticsUrl = function () {\n      return staticsUrl;\n    };\n\n    this.setStaticsUrl = function (url) {\n      staticsUrl = url &&\n        url.replace(/\\/?$/, '/').replace(/^\\/\\//, location.protocol + '//');\n      $sceDelegateProvider.resourceUrlWhitelist([staticsUrl + '**', 'self']);\n    };\n\n    /* @ngInject */\n    this.$get = [\"$window\", \"$document\", \"$location\", \"$injector\", function ($window, $document, $location, $injector) {\n      var origin = $document.find && $document.find('base').attr('href') ?\n        $window.location.protocol + '//' + $window.location.host : '';\n\n      function fixOrigin(url) {\n        return url.replace(/^([^\\/]*\\/\\/+)?[^\\/]*/, origin);\n      }\n\n      var wixAngularTopology = {};\n      wixAngularTopology.fixOrigin = fixOrigin;\n      wixAngularTopology.calcPartialsUrl = function (staticsUrl, force) {\n        if (!force &&\n            $location.protocol &&\n            $location.protocol() === 'https' &&\n            $injector.has('experimentManager') &&\n            $injector.get('experimentManager').isExperimentEnabled('specs.cx.UseCorsInPartials')) {\n          return staticsUrl;\n        } else {\n          return staticsUrl ? fixOrigin(staticsUrl.replace('/services/', '/_partials/')) : '';\n        }\n      };\n      wixAngularTopology.staticsUrl = staticsUrl ? staticsUrl : '';\n      wixAngularTopology.partialsUrl = staticsUrl ?\n        fixOrigin(staticsUrl.replace('/services/', '/_partials/')) : '';\n      return wixAngularTopology;\n    }];\n    this.$get.$inject = [\"$window\", \"$document\", \"$location\", \"$injector\"];\n  }\n  WixAngularTopology.$inject = [\"$sceDelegateProvider\"];\n\n  angular\n    .module('wixAngularAppInternal')\n    .provider('wixAngularTopology', WixAngularTopology);\n})();\n\n/// <reference path=\"../reference.ts\" />\n'use strict';\nwindow.jsonpExperiemts = {};\n/* jshint ignore:start */\nwindow.loadExperimentScopeSync = function (scope) {\n    var url = '//www.wix.com/_api/wix-laboratory-server/laboratory/conductAllInScope?scope=' +\n        scope + '&accept=jsonp&callback=setExperimentsSync';\n    document.write('<script src=\"' + url + '\"></script>');\n    window.setExperimentsSync = function (junk, experiments) {\n        angular.extend(window.jsonpExperiemts, experiments);\n    };\n};\n/* jshint ignore:end */\nvar ExperimentManager = (function () {\n    /* @ngInject */\n    function ExperimentManager(provider, $http) {\n        this.provider = provider;\n        this.$http = $http;\n        this.petriUrlPrefix = '/_api/wix-laboratory-server/laboratory/';\n        this.getExperimentValue = provider.getExperimentValue.bind(provider);\n        this.isExperimentEnabled = provider.isExperimentEnabled.bind(provider);\n    }\n    ExperimentManager.$inject = [\"provider\", \"$http\"];\n    ExperimentManager.prototype.get = function (value) {\n        return this.getExperimentValue(value);\n    };\n    ExperimentManager.prototype.contains = function (value) {\n        return this.isExperimentEnabled(value);\n    };\n    ExperimentManager.prototype.loadScope = function (scope) {\n        var _this = this;\n        return this.$$queryPetri({ scope: scope }).then(function (experiments) {\n            _this.provider.setExperiments(experiments);\n            return experiments;\n        });\n    };\n    ExperimentManager.prototype.loadExperiment = function (name, fallback) {\n        var _this = this;\n        return this.$$queryPetri({ name: name, fallback: fallback }).then(function (value) {\n            var singleExperiment = {};\n            singleExperiment[name] = value;\n            _this.provider.setExperiments(singleExperiment);\n            return value;\n        });\n    };\n    ExperimentManager.prototype.$$queryPetri = function (params) {\n        return this.$http.get(this.getPetriUrl(params), {\n            params: this.getQueryParams(params),\n            cache: true\n        }).then(function (result) {\n            return result.data;\n        });\n    };\n    ExperimentManager.prototype.$$getExperimentsObj = function () {\n        return this.provider.experiments;\n    };\n    ExperimentManager.prototype.getPetriUrl = function (params) {\n        return this.petriUrlPrefix + (params.scope ? 'conductAllInScope/' : 'conductExperiment/');\n    };\n    ExperimentManager.prototype.getQueryParams = function (params) {\n        return params.scope ? { scope: params.scope } : { key: params.name, fallback: params.fallback };\n    };\n    return ExperimentManager;\n})();\nvar ExperimentManagerProvider = (function () {\n    /* @ngInject */\n    function ExperimentManagerProvider() {\n        this.experiments = angular.copy(window.jsonpExperiemts);\n    }\n    ExperimentManagerProvider.prototype.clearExperiments = function () {\n        this.experiments = {};\n    };\n    ExperimentManagerProvider.prototype.isExperimentEnabled = function (name) {\n        return this.experiments[name] === 'true';\n    };\n    ExperimentManagerProvider.prototype.setExperiments = function (map) {\n        angular.extend(this.experiments, map);\n    };\n    ExperimentManagerProvider.prototype.getExperimentValue = function (name) {\n        return this.experiments[name];\n    };\n    /* @ngInject */\n    ExperimentManagerProvider.prototype.$get = function ($injector) {\n        return $injector.instantiate(ExperimentManager, { provider: this });\n    };\n    ExperimentManagerProvider.prototype.$get.$inject = [\"$injector\"];\n    return ExperimentManagerProvider;\n})();\nangular\n    .module('wixAngularExperiments')\n    .provider('experimentManager', ExperimentManagerProvider)\n    .run([\"$rootScope\", \"experimentManager\", function ($rootScope, experimentManager) {\n    $rootScope.experimentManager = experimentManager;\n}]);\n\n/* global window */\n'use strict';\n\nif (window.beforeEach) {\n  window.beforeEach(function () {\n    angular.module('experimentManagerMock').config([\"experimentManagerProvider\", function (experimentManagerProvider) {\n      experimentManagerProvider.clearExperiments();\n    }]);\n  });\n}\n\nangular.module('experimentManagerMock', [])\n  .config([\"$provide\", function ($provide) {\n    $provide.decorator('experimentManager', [\"$delegate\", \"$q\", function ($delegate, $q) {\n      var originalGetExperimentValue = $delegate.getExperimentValue.bind($delegate);\n      var originalIsExperimentEnabled = $delegate.isExperimentEnabled.bind($delegate);\n      var scopeToExperiments = {};\n      var unexpected = [];\n      var used = [];\n\n      function addIfNotExist(val, group) {\n        if (group.indexOf(val) === -1) {\n          group.push(val);\n        }\n      }\n\n      function markAsUsedOrUnexpected(experiment) {\n        if (originalGetExperimentValue(experiment) === undefined) {\n          addIfNotExist(experiment, unexpected);\n        } else {\n          addIfNotExist(experiment, used);\n        }\n      }\n\n      function resolvePromise(params) {\n        var deferred = $q.defer();\n        if (params.scope) {\n          deferred.resolve(scopeToExperiments[params.scope] || {});\n        } else {\n          deferred.resolve(Object.keys(scopeToExperiments).reduce(function (prev, scope) {\n            return prev || scopeToExperiments[scope][params.name];\n          }, undefined) || params.fallback);\n        }\n        return deferred.promise;\n      }\n\n      $delegate.getExperimentValue = function (name) {\n        markAsUsedOrUnexpected(name);\n        return originalGetExperimentValue(name);\n      };\n\n      $delegate.isExperimentEnabled = function (name) {\n        markAsUsedOrUnexpected(name);\n        return originalIsExperimentEnabled(name);\n      };\n\n      $delegate.$$queryPetri = function (params) {\n        return $q.when(params).then(resolvePromise);\n      };\n\n      $delegate.setScopeExperiments = function (str, map) {\n        scopeToExperiments[str] = map;\n      };\n\n      $delegate.verifyNoUnexpectedExperiments = function () {\n        if (unexpected.length) {\n          throw 'unexpected experiments: ' + unexpected.join(', ');\n        }\n      };\n\n      $delegate.verifyNoUnusedExperiments = function () {\n        var unused = Object.keys($delegate.$$getExperimentsObj()).filter(function (experiment) {\n          return used.indexOf(experiment) === -1;\n        });\n        if (unused.length) {\n          throw 'unused experiments: ' + unused.join(', ');\n        }\n      };\n\n      return $delegate;\n    }]);\n  }]);\n\n/// <reference path=\"../reference.ts\" />\n'use strict';\nvar PermissionsManager = (function () {\n    /* @ngInject */\n    function PermissionsManager(provider) {\n        this.provider = provider;\n    }\n    PermissionsManager.$inject = [\"provider\"];\n    PermissionsManager.prototype.contains = function (value) {\n        return this.getIndexOf(value) !== -1;\n    };\n    PermissionsManager.prototype.get = function (value) {\n        return this.contains(value).toString();\n    };\n    PermissionsManager.prototype.loadScope = function (scope) {\n        throw new Error('This method is not implemented.');\n    };\n    PermissionsManager.prototype.getIndexOf = function (value) {\n        return this.provider.permissions.indexOf(value);\n    };\n    return PermissionsManager;\n})();\nvar PermissionsManagerProvider = (function () {\n    /* @ngInject */\n    function PermissionsManagerProvider() {\n        this.permissions = [];\n    }\n    PermissionsManagerProvider.prototype.setPermissions = function (permissions) {\n        this.permissions = permissions;\n    };\n    PermissionsManagerProvider.prototype.clearPermissions = function () {\n        angular.copy([], this.permissions);\n    };\n    /* @ngInject */\n    PermissionsManagerProvider.prototype.$get = function ($injector) {\n        return $injector.instantiate(PermissionsManager, { provider: this });\n    };\n    PermissionsManagerProvider.prototype.$get.$inject = [\"$injector\"];\n    return PermissionsManagerProvider;\n})();\nangular\n    .module('wixAngularPermissions')\n    .provider('permissionsManager', PermissionsManagerProvider);\n"]}