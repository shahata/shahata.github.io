{"version":3,"file":"modules.js","sources":["../concat/scripts/modules.js"],"names":["root","factory","exports","module","require","define","amd","URI","punycode","IPv6","SecondLevelDomains","this","SLD","url","base","undefined","location","href","absoluteTo","escapeRegEx","string","replace","getType","value","String","Object","prototype","toString","call","slice","isArray","obj","filterArrayValues","data","i","length","lookup","splice","arrayContains","list","_type","match","arraysEqual","one","two","sort","l","escapeForDumbFirefox36","escape","strictEncodeURIComponent","encodeURIComponent","_URI","version","p","hasOwn","hasOwnProperty","_parts","protocol","username","password","hostname","urn","port","path","query","fragment","duplicateQueryParameters","escapeQuerySpace","protocol_expression","idn_expression","punycode_expression","ip4_expression","ip6_expression","find_uri_expression","findUri","start","end","trim","defaultPorts","http","https","ftp","gopher","ws","wss","invalid_hostname_characters","domAttributes","a","blockquote","link","script","form","img","area","iframe","embed","source","track","input","getDomAttribute","node","nodeName","toLowerCase","type","encode","decode","decodeURIComponent","iso8859","unescape","unicode","characters","pathname","expression","map","%24","%26","%2B","%2C","%3B","%3D","%3A","%40","/","?","#","reserved","%2F","%3F","%23","%5B","%5D","%21","%27","%28","%29","%2A","encodeQuery","escaped","decodeQuery","e","recodePath","segments","split","encodePathSegment","join","decodePath","decodePathSegment","_part","generateAccessor","_group","c","encodeReserved","parse","parts","pos","indexOf","substring","parseAuthority","parseHost","bracketPos","t","charAt","lastIndexOf","parseUserinfo","firstSlash","shift","parseQuery","v","name","items","splits","push","build","buildAuthority","buildHost","test","buildUserinfo","buildQuery","unique","key","buildQueryParameter","addQuery","TypeError","concat","removeQuery","hasQuery","withinArray","_booly","Boolean","op","commonPath","Math","min","withinString","callback","options","_start","_end","_trim","_attributeOpen","lastIndex","exec","index","ignoreHtml","attributeOpen","max","search","ignore","result","ensureValidHostname","toASCII","noConflict","removeAll","unconflicted","URITemplate","deferBuild","_deferred_build","_string","clone","valueOf","_key","hash","res","_object","attribute","src","is","what","ip","ip4","ip6","sld","idn","relative","has","_protocol","_port","_hostname","scheme","x","host","authority","userinfo","resource","subdomain","domain","sub","RegExp","tld","get","ReferenceError","directory","filename","mutatedDirectory","normalizePath","suffix","s","segment","separator","absolute","Error","pop","unshift","segmentCoded","q","setQuery","setSearch","addSearch","removeSearch","hasSearch","normalize","normalizeProtocol","normalizeQuery","normalizeFragment","normalizeHostname","normalizePort","best","_was_relative","_parent","_pos","_path","_leadingParents","normalizePathname","normalizeSearch","normalizeHash","d","readable","uri","toUnicode","qp","kv","basedir","resolved","properties","relativeTo","relativeParts","baseParts","common","relativePath","basePath","parents","equals","one_query","two_query","one_map","two_map","checked","angular","config","$httpProvider","wixAngularTopologyProvider","interceptors","getStaticsUrl","setStaticsUrl","element","document","find","attr","constant","LOGGED_OUT","NOT_FOUND","RUNTIME_EXCEPTION","SERVER_ERROR","QUOTA_EXCEEDED","WixAngularStorageController","wixCache","wixStorage","getOptions","siteId","that","noCache","writeData","eraseData","cache","set","setWithGUID","then","remove","remote","$inject","controller","wixTranslateCompile","$translate","$compile","$parse","restrict","scope","attrs","values","translateValues","content","html","contents","directive","relativeHref","wixAngularTopology","priority","$observe","$set","staticsUrl","relativeSrc","hookPreLink","fn","pre","post","hooked","apply","arguments","wixManagersNgDirective","manager","ngDirective","directiveName","ngAttributeName","parseNegation","expr","negationGroups","negation","contains","ngDir","ddo","copy","compile","ret","defineNgDirective","$injector","invoke","experimentManager","ngIfDirective","permissionsManager","ngDisabledDirective","wixManagersClass","valuesToCheck","classToAdd","addClass","defineClassDirective","wixAngularInterceptorFactory","$q","wixCookies","$rootScope","wixAngularEvents","errorHandler","response","reject","checkUserSwitch","firstUserSwitchTest","previousUserGUID","userGUID","$emit","userSwitch","wixAngularInterceptor","request","calcPartialsUrl","fixOrigin","success","status","payload","responseError","WixAngular","experimentManagerProvider","isExperimentEnabled","bind","setExperiments","$get","wixAngular","experiments","$$getExperimentsObj","partialsUrl","provider","wixCacheFactory","recordUtils","crossStorage","wixAngularStorageErrors","DEFAULT_AGE_IN_SEC","DATA_TYPE","ADHOC_TYPE","REMOTE_TYPE","CLEAN_EPSILON","rejectWithRuntimeException","getCrossStorage","onConnect","tryToSet","returnKey","cacheKey","getCacheKey","reason","clear","getRecordSize","validateKey","validateData","validateExpiration","createdAt","Date","now","extend","expiration","generateRandomKey","opts","record","isExpired","del","isUserLoggedIn","wixCookiesFactory","cookieStr","parseUserCookie","cookie","cookieParts","guid","userName","parseAllCookies","cookies","str","reduce","acc","curr","args","getParsedUserCookie","prevCookies","parsedUser","wixClient",{"end":{"file":"../concat/scripts/modules.js","comments_before":[],"nlb":false,"endpos":73759,"endcol":24,"endline":2432,"pos":73751,"col":16,"line":2432,"value":"userGUID","type":"name"},"start":{"file":"../concat/scripts/modules.js","comments_before":[],"nlb":false,"endpos":73759,"endcol":24,"endline":2432,"pos":73751,"col":16,"line":2432,"value":"userGUID","type":"name"},"name":"userGUID"},"$document","LOCAL_STORAGE_FRAME_ID","promiseCtor","resolver","dfd","defer","resolve","promise","when","CrossStorageClient","amount","_request","frameId","crossStorageCleanerFactory","$window","$interval","MAX_STORAGE_SIZE_IN_BYTES","CLEANING_INTERVAL","removeFromArray","item","arr","itemIndex","chooseArrayByType","dataKeys","remoteAndAdhocKeys","clearRecord","hub","_get","keys","recordSize","_del","clearRecords","getWixCacheKeys","_getKeys","filter","hasPrefix","getWixCacheSize","loadExistingWixCacheKeys","createdAtSort","b","getKey","forEach","decorateInit","permissions","_clear","init","decorateSet","params","_set","clearOtherUsers","belongsToCurrentUser","clearExpiredRecords","clearNonExpiredRecord","CrossStorageHub","requiredSpace","clearedSpace","size","removedRecordsSpace","removed","origin","allow","run","wixStorageFactory","$http","ANGULAR_STORAGE_PREFIX","cacheRemoteData","getRemote","identity","err","tryCache","dto","nameSpace","blob","TTLInDays","ceil","recordUtilsFactory","KEY_SEPARATOR","MAX_KEY_LENGTH","MAX_VALUE_SIZE_IN_BYTES","MAX_AGE_IN_SEC","countBytes","encodeURI","hasExpiration","val","JSON","stringify","random","WixAngularTopology","$sceDelegateProvider","resourceUrlWhitelist","$location","force","window","jsonpExperiemts","loadExperimentScopeSync","write","setExperimentsSync","junk","ExperimentManager","petriUrlPrefix","getExperimentValue","loadScope","_this","$$queryPetri","loadExperiment","fallback","singleExperiment","getPetriUrl","getQueryParams","ExperimentManagerProvider","clearExperiments","instantiate","beforeEach","$provide","decorator","$delegate","addIfNotExist","group","markAsUsedOrUnexpected","experiment","originalGetExperimentValue","unexpected","used","resolvePromise","deferred","scopeToExperiments","prev","originalIsExperimentEnabled","setScopeExperiments","verifyNoUnexpectedExperiments","verifyNoUnusedExperiments","unused","PermissionsManager","getIndexOf","PermissionsManagerProvider","setPermissions","clearPermissions","W","BI","Logger","DomEventHandler","ErrorSeverity","RECOVERABLE","WARNING","ERROR","FATAL","Categories","EDITOR","VIEWER","TIMEOUTS","SERVER","getTime","_extend","dst","extending","biLogger","_log","eventArgs","_biFieldsRestrictions","evid","eventParams","defaultEventArgs","_options","_validateBiEventArgs","_sendBiEvent","_error","errorArgs","_requiredErrorFields","_errorFieldsRestrictions","EVENT_IDS","cat","iss","sev","errc","httpc","ver","maxLength","errscp","subStr","trgt","gsi","ts","uid","ut","did","cid","lng","dsc","errorParams","defaultErrorArgs","_reportOnReady","viewName","_onReadyFieldsRestrictions","view","ON_READY","_reportRouteChange","_routeChangeFieldsRestrictions","ROUTE_CHANGE","requiredArgs","restrictions","missingRequiredArgs","currentRestrictions","fieldParsers","valid","error","missingIndex","_addUrlParams","delimiter","frogAdapter","adapter","biUrl","biImage","Image","onComplete","onload","onerror","_lastBiUrl","assertEmpty","FieldParsers","injector","hostName","_initOptions","log","reportOnReady","reportRouteChange","getLastBiUrl","startTime","_","eventHandler","_safeGetEventParams","eventName","eventMap","explicitParams","_biLogger","errorName","errorMap","_getAttr","attributes","_handleTriggeredBiEvent","event","target","_wixBiAttributeSelector","eventArgsStr","_wixBiArgsAttribute","eval","_bind","body","addEventListener","_unbind","removeEventListener","unbind","validators","parsers","substr","domBiLogger","convertAttrToConst","toUpperCase","eventType","wixBiEvent","wixBi","$eval","wixBiArgs","recursiveExtend","_config","setConfig","getConfig","isObject","constructor","Array","applyModifications","conf","partial","k","biLoggerProvider","domBiLoggerProvider","makeCb","$apply","getReducedMap","isNewRelicDefined","NREUM","reportedToNewRelic","finished","events","errors"],"mappings":"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","sourcesContent":["/*!\n * URI.js - Mutating URLs\n *\n * Version: 1.13.2\n *\n * Author: Rodney Rehm\n * Web: http://medialize.github.io/URI.js/\n *\n * Licensed under\n *   MIT License http://www.opensource.org/licenses/mit-license\n *   GPL v3 http://opensource.org/licenses/GPL-3.0\n *\n */\n(function (root, factory) {\n  'use strict';\n  // https://github.com/umdjs/umd/blob/master/returnExports.js\n  if (typeof exports === 'object') {\n    // Node\n    module.exports = factory(require('./punycode'), require('./IPv6'), require('./SecondLevelDomains'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define(['./punycode', './IPv6', './SecondLevelDomains'], factory);\n  } else {\n    // Browser globals (root is window)\n    root.URI = factory(root.punycode, root.IPv6, root.SecondLevelDomains, root);\n  }\n}(this, function (punycode, IPv6, SLD, root) {\n  'use strict';\n  /*global location, escape, unescape */\n  // FIXME: v2.0.0 renamce non-camelCase properties to uppercase\n  /*jshint camelcase: false */\n\n  // save current URI variable, if any\n  var _URI = root && root.URI;\n\n  function URI(url, base) {\n    // Allow instantiation without the 'new' keyword\n    if (!(this instanceof URI)) {\n      return new URI(url, base);\n    }\n\n    if (url === undefined) {\n      if (typeof location !== 'undefined') {\n        url = location.href + '';\n      } else {\n        url = '';\n      }\n    }\n\n    this.href(url);\n\n    // resolve to base according to http://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#constructor\n    if (base !== undefined) {\n      return this.absoluteTo(base);\n    }\n\n    return this;\n  }\n\n  URI.version = '1.13.2';\n\n  var p = URI.prototype;\n  var hasOwn = Object.prototype.hasOwnProperty;\n\n  function escapeRegEx(string) {\n    // https://github.com/medialize/URI.js/commit/85ac21783c11f8ccab06106dba9735a31a86924d#commitcomment-821963\n    return string.replace(/([.*+?^=!:${}()|[\\]\\/\\\\])/g, '\\\\$1');\n  }\n\n  function getType(value) {\n    // IE8 doesn't return [Object Undefined] but [Object Object] for undefined value\n    if (value === undefined) {\n      return 'Undefined';\n    }\n\n    return String(Object.prototype.toString.call(value)).slice(8, -1);\n  }\n\n  function isArray(obj) {\n    return getType(obj) === 'Array';\n  }\n\n  function filterArrayValues(data, value) {\n    var lookup = {};\n    var i, length;\n\n    if (isArray(value)) {\n      for (i = 0, length = value.length; i < length; i++) {\n        lookup[value[i]] = true;\n      }\n    } else {\n      lookup[value] = true;\n    }\n\n    for (i = 0, length = data.length; i < length; i++) {\n      if (lookup[data[i]] !== undefined) {\n        data.splice(i, 1);\n        length--;\n        i--;\n      }\n    }\n\n    return data;\n  }\n\n  function arrayContains(list, value) {\n    var i, length;\n\n    // value may be string, number, array, regexp\n    if (isArray(value)) {\n      // Note: this can be optimized to O(n) (instead of current O(m * n))\n      for (i = 0, length = value.length; i < length; i++) {\n        if (!arrayContains(list, value[i])) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n\n    var _type = getType(value);\n    for (i = 0, length = list.length; i < length; i++) {\n      if (_type === 'RegExp') {\n        if (typeof list[i] === 'string' && list[i].match(value)) {\n          return true;\n        }\n      } else if (list[i] === value) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  function arraysEqual(one, two) {\n    if (!isArray(one) || !isArray(two)) {\n      return false;\n    }\n\n    // arrays can't be equal if they have different amount of content\n    if (one.length !== two.length) {\n      return false;\n    }\n\n    one.sort();\n    two.sort();\n\n    for (var i = 0, l = one.length; i < l; i++) {\n      if (one[i] !== two[i]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  URI._parts = function() {\n    return {\n      protocol: null,\n      username: null,\n      password: null,\n      hostname: null,\n      urn: null,\n      port: null,\n      path: null,\n      query: null,\n      fragment: null,\n      // state\n      duplicateQueryParameters: URI.duplicateQueryParameters,\n      escapeQuerySpace: URI.escapeQuerySpace\n    };\n  };\n  // state: allow duplicate query parameters (a=1&a=1)\n  URI.duplicateQueryParameters = false;\n  // state: replaces + with %20 (space in query strings)\n  URI.escapeQuerySpace = true;\n  // static properties\n  URI.protocol_expression = /^[a-z][a-z0-9.+-]*$/i;\n  URI.idn_expression = /[^a-z0-9\\.-]/i;\n  URI.punycode_expression = /(xn--)/i;\n  // well, 333.444.555.666 matches, but it sure ain't no IPv4 - do we care?\n  URI.ip4_expression = /^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$/;\n  // credits to Rich Brown\n  // source: http://forums.intermapper.com/viewtopic.php?p=1096#1096\n  // specification: http://www.ietf.org/rfc/rfc4291.txt\n  URI.ip6_expression = /^\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\\s*$/;\n  // expression used is \"gruber revised\" (@gruber v2) determined to be the\n  // best solution in a regex-golf we did a couple of ages ago at\n  // * http://mathiasbynens.be/demo/url-regex\n  // * http://rodneyrehm.de/t/url-regex.html\n  URI.find_uri_expression = /\\b((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?«»“”‘’]))/ig;\n  URI.findUri = {\n    // valid \"scheme://\" or \"www.\"\n    start: /\\b(?:([a-z][a-z0-9.+-]*:\\/\\/)|www\\.)/gi,\n    // everything up to the next whitespace\n    end: /[\\s\\r\\n]|$/,\n    // trim trailing punctuation captured by end RegExp\n    trim: /[`!()\\[\\]{};:'\".,<>?«»“”„‘’]+$/\n  };\n  // http://www.iana.org/assignments/uri-schemes.html\n  // http://en.wikipedia.org/wiki/List_of_TCP_and_UDP_port_numbers#Well-known_ports\n  URI.defaultPorts = {\n    http: '80',\n    https: '443',\n    ftp: '21',\n    gopher: '70',\n    ws: '80',\n    wss: '443'\n  };\n  // allowed hostname characters according to RFC 3986\n  // ALPHA DIGIT \"-\" \".\" \"_\" \"~\" \"!\" \"$\" \"&\" \"'\" \"(\" \")\" \"*\" \"+\" \",\" \";\" \"=\" %encoded\n  // I've never seen a (non-IDN) hostname other than: ALPHA DIGIT . -\n  URI.invalid_hostname_characters = /[^a-zA-Z0-9\\.-]/;\n  // map DOM Elements to their URI attribute\n  URI.domAttributes = {\n    'a': 'href',\n    'blockquote': 'cite',\n    'link': 'href',\n    'base': 'href',\n    'script': 'src',\n    'form': 'action',\n    'img': 'src',\n    'area': 'href',\n    'iframe': 'src',\n    'embed': 'src',\n    'source': 'src',\n    'track': 'src',\n    'input': 'src' // but only if type=\"image\"\n  };\n  URI.getDomAttribute = function(node) {\n    if (!node || !node.nodeName) {\n      return undefined;\n    }\n\n    var nodeName = node.nodeName.toLowerCase();\n    // <input> should only expose src for type=\"image\"\n    if (nodeName === 'input' && node.type !== 'image') {\n      return undefined;\n    }\n\n    return URI.domAttributes[nodeName];\n  };\n\n  function escapeForDumbFirefox36(value) {\n    // https://github.com/medialize/URI.js/issues/91\n    return escape(value);\n  }\n\n  // encoding / decoding according to RFC3986\n  function strictEncodeURIComponent(string) {\n    // see https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/encodeURIComponent\n    return encodeURIComponent(string)\n      .replace(/[!'()*]/g, escapeForDumbFirefox36)\n      .replace(/\\*/g, '%2A');\n  }\n  URI.encode = strictEncodeURIComponent;\n  URI.decode = decodeURIComponent;\n  URI.iso8859 = function() {\n    URI.encode = escape;\n    URI.decode = unescape;\n  };\n  URI.unicode = function() {\n    URI.encode = strictEncodeURIComponent;\n    URI.decode = decodeURIComponent;\n  };\n  URI.characters = {\n    pathname: {\n      encode: {\n        // RFC3986 2.1: For consistency, URI producers and normalizers should\n        // use uppercase hexadecimal digits for all percent-encodings.\n        expression: /%(24|26|2B|2C|3B|3D|3A|40)/ig,\n        map: {\n          // -._~!'()*\n          '%24': '$',\n          '%26': '&',\n          '%2B': '+',\n          '%2C': ',',\n          '%3B': ';',\n          '%3D': '=',\n          '%3A': ':',\n          '%40': '@'\n        }\n      },\n      decode: {\n        expression: /[\\/\\?#]/g,\n        map: {\n          '/': '%2F',\n          '?': '%3F',\n          '#': '%23'\n        }\n      }\n    },\n    reserved: {\n      encode: {\n        // RFC3986 2.1: For consistency, URI producers and normalizers should\n        // use uppercase hexadecimal digits for all percent-encodings.\n        expression: /%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,\n        map: {\n          // gen-delims\n          '%3A': ':',\n          '%2F': '/',\n          '%3F': '?',\n          '%23': '#',\n          '%5B': '[',\n          '%5D': ']',\n          '%40': '@',\n          // sub-delims\n          '%21': '!',\n          '%24': '$',\n          '%26': '&',\n          '%27': '\\'',\n          '%28': '(',\n          '%29': ')',\n          '%2A': '*',\n          '%2B': '+',\n          '%2C': ',',\n          '%3B': ';',\n          '%3D': '='\n        }\n      }\n    }\n  };\n  URI.encodeQuery = function(string, escapeQuerySpace) {\n    var escaped = URI.encode(string + '');\n    if (escapeQuerySpace === undefined) {\n      escapeQuerySpace = URI.escapeQuerySpace;\n    }\n\n    return escapeQuerySpace ? escaped.replace(/%20/g, '+') : escaped;\n  };\n  URI.decodeQuery = function(string, escapeQuerySpace) {\n    string += '';\n    if (escapeQuerySpace === undefined) {\n      escapeQuerySpace = URI.escapeQuerySpace;\n    }\n\n    try {\n      return URI.decode(escapeQuerySpace ? string.replace(/\\+/g, '%20') : string);\n    } catch(e) {\n      // we're not going to mess with weird encodings,\n      // give up and return the undecoded original string\n      // see https://github.com/medialize/URI.js/issues/87\n      // see https://github.com/medialize/URI.js/issues/92\n      return string;\n    }\n  };\n  URI.recodePath = function(string) {\n    var segments = (string + '').split('/');\n    for (var i = 0, length = segments.length; i < length; i++) {\n      segments[i] = URI.encodePathSegment(URI.decode(segments[i]));\n    }\n\n    return segments.join('/');\n  };\n  URI.decodePath = function(string) {\n    var segments = (string + '').split('/');\n    for (var i = 0, length = segments.length; i < length; i++) {\n      segments[i] = URI.decodePathSegment(segments[i]);\n    }\n\n    return segments.join('/');\n  };\n  // generate encode/decode path functions\n  var _parts = {'encode':'encode', 'decode':'decode'};\n  var _part;\n  var generateAccessor = function(_group, _part) {\n    return function(string) {\n      return URI[_part](string + '').replace(URI.characters[_group][_part].expression, function(c) {\n        return URI.characters[_group][_part].map[c];\n      });\n    };\n  };\n\n  for (_part in _parts) {\n    URI[_part + 'PathSegment'] = generateAccessor('pathname', _parts[_part]);\n  }\n\n  URI.encodeReserved = generateAccessor('reserved', 'encode');\n\n  URI.parse = function(string, parts) {\n    var pos;\n    if (!parts) {\n      parts = {};\n    }\n    // [protocol\"://\"[username[\":\"password]\"@\"]hostname[\":\"port]\"/\"?][path][\"?\"querystring][\"#\"fragment]\n\n    // extract fragment\n    pos = string.indexOf('#');\n    if (pos > -1) {\n      // escaping?\n      parts.fragment = string.substring(pos + 1) || null;\n      string = string.substring(0, pos);\n    }\n\n    // extract query\n    pos = string.indexOf('?');\n    if (pos > -1) {\n      // escaping?\n      parts.query = string.substring(pos + 1) || null;\n      string = string.substring(0, pos);\n    }\n\n    // extract protocol\n    if (string.substring(0, 2) === '//') {\n      // relative-scheme\n      parts.protocol = null;\n      string = string.substring(2);\n      // extract \"user:pass@host:port\"\n      string = URI.parseAuthority(string, parts);\n    } else {\n      pos = string.indexOf(':');\n      if (pos > -1) {\n        parts.protocol = string.substring(0, pos) || null;\n        if (parts.protocol && !parts.protocol.match(URI.protocol_expression)) {\n          // : may be within the path\n          parts.protocol = undefined;\n        } else if (parts.protocol === 'file') {\n          // the file scheme: does not contain an authority\n          string = string.substring(pos + 3);\n        } else if (string.substring(pos + 1, pos + 3) === '//') {\n          string = string.substring(pos + 3);\n\n          // extract \"user:pass@host:port\"\n          string = URI.parseAuthority(string, parts);\n        } else {\n          string = string.substring(pos + 1);\n          parts.urn = true;\n        }\n      }\n    }\n\n    // what's left must be the path\n    parts.path = string;\n\n    // and we're done\n    return parts;\n  };\n  URI.parseHost = function(string, parts) {\n    // extract host:port\n    var pos = string.indexOf('/');\n    var bracketPos;\n    var t;\n\n    if (pos === -1) {\n      pos = string.length;\n    }\n\n    if (string.charAt(0) === '[') {\n      // IPv6 host - http://tools.ietf.org/html/draft-ietf-6man-text-addr-representation-04#section-6\n      // I claim most client software breaks on IPv6 anyways. To simplify things, URI only accepts\n      // IPv6+port in the format [2001:db8::1]:80 (for the time being)\n      bracketPos = string.indexOf(']');\n      parts.hostname = string.substring(1, bracketPos) || null;\n      parts.port = string.substring(bracketPos + 2, pos) || null;\n      if (parts.port === '/') {\n        parts.port = null;\n      }\n    } else if (string.indexOf(':') !== string.lastIndexOf(':')) {\n      // IPv6 host contains multiple colons - but no port\n      // this notation is actually not allowed by RFC 3986, but we're a liberal parser\n      parts.hostname = string.substring(0, pos) || null;\n      parts.port = null;\n    } else {\n      t = string.substring(0, pos).split(':');\n      parts.hostname = t[0] || null;\n      parts.port = t[1] || null;\n    }\n\n    if (parts.hostname && string.substring(pos).charAt(0) !== '/') {\n      pos++;\n      string = '/' + string;\n    }\n\n    return string.substring(pos) || '/';\n  };\n  URI.parseAuthority = function(string, parts) {\n    string = URI.parseUserinfo(string, parts);\n    return URI.parseHost(string, parts);\n  };\n  URI.parseUserinfo = function(string, parts) {\n    // extract username:password\n    var firstSlash = string.indexOf('/');\n    /*jshint laxbreak: true */\n    var pos = firstSlash > -1\n      ? string.lastIndexOf('@', firstSlash)\n      : string.indexOf('@');\n    /*jshint laxbreak: false */\n    var t;\n\n    // authority@ must come before /path\n    if (pos > -1 && (firstSlash === -1 || pos < firstSlash)) {\n      t = string.substring(0, pos).split(':');\n      parts.username = t[0] ? URI.decode(t[0]) : null;\n      t.shift();\n      parts.password = t[0] ? URI.decode(t.join(':')) : null;\n      string = string.substring(pos + 1);\n    } else {\n      parts.username = null;\n      parts.password = null;\n    }\n\n    return string;\n  };\n  URI.parseQuery = function(string, escapeQuerySpace) {\n    if (!string) {\n      return {};\n    }\n\n    // throw out the funky business - \"?\"[name\"=\"value\"&\"]+\n    string = string.replace(/&+/g, '&').replace(/^\\?*&*|&+$/g, '');\n\n    if (!string) {\n      return {};\n    }\n\n    var items = {};\n    var splits = string.split('&');\n    var length = splits.length;\n    var v, name, value;\n\n    for (var i = 0; i < length; i++) {\n      v = splits[i].split('=');\n      name = URI.decodeQuery(v.shift(), escapeQuerySpace);\n      // no \"=\" is null according to http://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#collect-url-parameters\n      value = v.length ? URI.decodeQuery(v.join('='), escapeQuerySpace) : null;\n\n      if (items[name]) {\n        if (typeof items[name] === 'string') {\n          items[name] = [items[name]];\n        }\n\n        items[name].push(value);\n      } else {\n        items[name] = value;\n      }\n    }\n\n    return items;\n  };\n\n  URI.build = function(parts) {\n    var t = '';\n\n    if (parts.protocol) {\n      t += parts.protocol + ':';\n    }\n\n    if (!parts.urn && (t || parts.hostname)) {\n      t += '//';\n    }\n\n    t += (URI.buildAuthority(parts) || '');\n\n    if (typeof parts.path === 'string') {\n      if (parts.path.charAt(0) !== '/' && typeof parts.hostname === 'string') {\n        t += '/';\n      }\n\n      t += parts.path;\n    }\n\n    if (typeof parts.query === 'string' && parts.query) {\n      t += '?' + parts.query;\n    }\n\n    if (typeof parts.fragment === 'string' && parts.fragment) {\n      t += '#' + parts.fragment;\n    }\n    return t;\n  };\n  URI.buildHost = function(parts) {\n    var t = '';\n\n    if (!parts.hostname) {\n      return '';\n    } else if (URI.ip6_expression.test(parts.hostname)) {\n      t += '[' + parts.hostname + ']';\n    } else {\n      t += parts.hostname;\n    }\n\n    if (parts.port) {\n      t += ':' + parts.port;\n    }\n\n    return t;\n  };\n  URI.buildAuthority = function(parts) {\n    return URI.buildUserinfo(parts) + URI.buildHost(parts);\n  };\n  URI.buildUserinfo = function(parts) {\n    var t = '';\n\n    if (parts.username) {\n      t += URI.encode(parts.username);\n\n      if (parts.password) {\n        t += ':' + URI.encode(parts.password);\n      }\n\n      t += '@';\n    }\n\n    return t;\n  };\n  URI.buildQuery = function(data, duplicateQueryParameters, escapeQuerySpace) {\n    // according to http://tools.ietf.org/html/rfc3986 or http://labs.apache.org/webarch/uri/rfc/rfc3986.html\n    // being »-._~!$&'()*+,;=:@/?« %HEX and alnum are allowed\n    // the RFC explicitly states ?/foo being a valid use case, no mention of parameter syntax!\n    // URI.js treats the query string as being application/x-www-form-urlencoded\n    // see http://www.w3.org/TR/REC-html40/interact/forms.html#form-content-type\n\n    var t = '';\n    var unique, key, i, length;\n    for (key in data) {\n      if (hasOwn.call(data, key) && key) {\n        if (isArray(data[key])) {\n          unique = {};\n          for (i = 0, length = data[key].length; i < length; i++) {\n            if (data[key][i] !== undefined && unique[data[key][i] + ''] === undefined) {\n              t += '&' + URI.buildQueryParameter(key, data[key][i], escapeQuerySpace);\n              if (duplicateQueryParameters !== true) {\n                unique[data[key][i] + ''] = true;\n              }\n            }\n          }\n        } else if (data[key] !== undefined) {\n          t += '&' + URI.buildQueryParameter(key, data[key], escapeQuerySpace);\n        }\n      }\n    }\n\n    return t.substring(1);\n  };\n  URI.buildQueryParameter = function(name, value, escapeQuerySpace) {\n    // http://www.w3.org/TR/REC-html40/interact/forms.html#form-content-type -- application/x-www-form-urlencoded\n    // don't append \"=\" for null values, according to http://dvcs.w3.org/hg/url/raw-file/tip/Overview.html#url-parameter-serialization\n    return URI.encodeQuery(name, escapeQuerySpace) + (value !== null ? '=' + URI.encodeQuery(value, escapeQuerySpace) : '');\n  };\n\n  URI.addQuery = function(data, name, value) {\n    if (typeof name === 'object') {\n      for (var key in name) {\n        if (hasOwn.call(name, key)) {\n          URI.addQuery(data, key, name[key]);\n        }\n      }\n    } else if (typeof name === 'string') {\n      if (data[name] === undefined) {\n        data[name] = value;\n        return;\n      } else if (typeof data[name] === 'string') {\n        data[name] = [data[name]];\n      }\n\n      if (!isArray(value)) {\n        value = [value];\n      }\n\n      data[name] = data[name].concat(value);\n    } else {\n      throw new TypeError('URI.addQuery() accepts an object, string as the name parameter');\n    }\n  };\n  URI.removeQuery = function(data, name, value) {\n    var i, length, key;\n\n    if (isArray(name)) {\n      for (i = 0, length = name.length; i < length; i++) {\n        data[name[i]] = undefined;\n      }\n    } else if (typeof name === 'object') {\n      for (key in name) {\n        if (hasOwn.call(name, key)) {\n          URI.removeQuery(data, key, name[key]);\n        }\n      }\n    } else if (typeof name === 'string') {\n      if (value !== undefined) {\n        if (data[name] === value) {\n          data[name] = undefined;\n        } else if (isArray(data[name])) {\n          data[name] = filterArrayValues(data[name], value);\n        }\n      } else {\n        data[name] = undefined;\n      }\n    } else {\n      throw new TypeError('URI.addQuery() accepts an object, string as the first parameter');\n    }\n  };\n  URI.hasQuery = function(data, name, value, withinArray) {\n    if (typeof name === 'object') {\n      for (var key in name) {\n        if (hasOwn.call(name, key)) {\n          if (!URI.hasQuery(data, key, name[key])) {\n            return false;\n          }\n        }\n      }\n\n      return true;\n    } else if (typeof name !== 'string') {\n      throw new TypeError('URI.hasQuery() accepts an object, string as the name parameter');\n    }\n\n    switch (getType(value)) {\n      case 'Undefined':\n        // true if exists (but may be empty)\n        return name in data; // data[name] !== undefined;\n\n      case 'Boolean':\n        // true if exists and non-empty\n        var _booly = Boolean(isArray(data[name]) ? data[name].length : data[name]);\n        return value === _booly;\n\n      case 'Function':\n        // allow complex comparison\n        return !!value(data[name], name, data);\n\n      case 'Array':\n        if (!isArray(data[name])) {\n          return false;\n        }\n\n        var op = withinArray ? arrayContains : arraysEqual;\n        return op(data[name], value);\n\n      case 'RegExp':\n        if (!isArray(data[name])) {\n          return Boolean(data[name] && data[name].match(value));\n        }\n\n        if (!withinArray) {\n          return false;\n        }\n\n        return arrayContains(data[name], value);\n\n      case 'Number':\n        value = String(value);\n        /* falls through */\n      case 'String':\n        if (!isArray(data[name])) {\n          return data[name] === value;\n        }\n\n        if (!withinArray) {\n          return false;\n        }\n\n        return arrayContains(data[name], value);\n\n      default:\n        throw new TypeError('URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter');\n    }\n  };\n\n\n  URI.commonPath = function(one, two) {\n    var length = Math.min(one.length, two.length);\n    var pos;\n\n    // find first non-matching character\n    for (pos = 0; pos < length; pos++) {\n      if (one.charAt(pos) !== two.charAt(pos)) {\n        pos--;\n        break;\n      }\n    }\n\n    if (pos < 1) {\n      return one.charAt(0) === two.charAt(0) && one.charAt(0) === '/' ? '/' : '';\n    }\n\n    // revert to last /\n    if (one.charAt(pos) !== '/' || two.charAt(pos) !== '/') {\n      pos = one.substring(0, pos).lastIndexOf('/');\n    }\n\n    return one.substring(0, pos + 1);\n  };\n\n  URI.withinString = function(string, callback, options) {\n    options || (options = {});\n    var _start = options.start || URI.findUri.start;\n    var _end = options.end || URI.findUri.end;\n    var _trim = options.trim || URI.findUri.trim;\n    var _attributeOpen = /[a-z0-9-]=[\"']?$/i;\n\n    _start.lastIndex = 0;\n    while (true) {\n      var match = _start.exec(string);\n      if (!match) {\n        break;\n      }\n\n      var start = match.index;\n      if (options.ignoreHtml) {\n        // attribut(e=[\"']?$)\n        var attributeOpen = string.slice(Math.max(start - 3, 0), start);\n        if (attributeOpen && _attributeOpen.test(attributeOpen)) {\n          continue;\n        }\n      }\n\n      var end = start + string.slice(start).search(_end);\n      var slice = string.slice(start, end).replace(_trim, '');\n      if (options.ignore && options.ignore.test(slice)) {\n        continue;\n      }\n\n      end = start + slice.length;\n      var result = callback(slice, start, end, string);\n      string = string.slice(0, start) + result + string.slice(end);\n      _start.lastIndex = start + result.length;\n    }\n\n    _start.lastIndex = 0;\n    return string;\n  };\n\n  URI.ensureValidHostname = function(v) {\n    // Theoretically URIs allow percent-encoding in Hostnames (according to RFC 3986)\n    // they are not part of DNS and therefore ignored by URI.js\n\n    if (v.match(URI.invalid_hostname_characters)) {\n      // test punycode\n      if (!punycode) {\n        throw new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-] and Punycode.js is not available');\n      }\n\n      if (punycode.toASCII(v).match(URI.invalid_hostname_characters)) {\n        throw new TypeError('Hostname \"' + v + '\" contains characters other than [A-Z0-9.-]');\n      }\n    }\n  };\n\n  // noConflict\n  URI.noConflict = function(removeAll) {\n    if (removeAll) {\n      var unconflicted = {\n        URI: this.noConflict()\n      };\n\n      if (root.URITemplate && typeof root.URITemplate.noConflict === 'function') {\n        unconflicted.URITemplate = root.URITemplate.noConflict();\n      }\n\n      if (root.IPv6 && typeof root.IPv6.noConflict === 'function') {\n        unconflicted.IPv6 = root.IPv6.noConflict();\n      }\n\n      if (root.SecondLevelDomains && typeof root.SecondLevelDomains.noConflict === 'function') {\n        unconflicted.SecondLevelDomains = root.SecondLevelDomains.noConflict();\n      }\n\n      return unconflicted;\n    } else if (root.URI === this) {\n      root.URI = _URI;\n    }\n\n    return this;\n  };\n\n  p.build = function(deferBuild) {\n    if (deferBuild === true) {\n      this._deferred_build = true;\n    } else if (deferBuild === undefined || this._deferred_build) {\n      this._string = URI.build(this._parts);\n      this._deferred_build = false;\n    }\n\n    return this;\n  };\n\n  p.clone = function() {\n    return new URI(this);\n  };\n\n  p.valueOf = p.toString = function() {\n    return this.build(false)._string;\n  };\n\n  // generate simple accessors\n  _parts = {protocol: 'protocol', username: 'username', password: 'password', hostname: 'hostname',  port: 'port'};\n  generateAccessor = function(_part){\n    return function(v, build) {\n      if (v === undefined) {\n        return this._parts[_part] || '';\n      } else {\n        this._parts[_part] = v || null;\n        this.build(!build);\n        return this;\n      }\n    };\n  };\n\n  for (_part in _parts) {\n    p[_part] = generateAccessor(_parts[_part]);\n  }\n\n  // generate accessors with optionally prefixed input\n  _parts = {query: '?', fragment: '#'};\n  generateAccessor = function(_part, _key){\n    return function(v, build) {\n      if (v === undefined) {\n        return this._parts[_part] || '';\n      } else {\n        if (v !== null) {\n          v = v + '';\n          if (v.charAt(0) === _key) {\n            v = v.substring(1);\n          }\n        }\n\n        this._parts[_part] = v;\n        this.build(!build);\n        return this;\n      }\n    };\n  };\n\n  for (_part in _parts) {\n    p[_part] = generateAccessor(_part, _parts[_part]);\n  }\n\n  // generate accessors with prefixed output\n  _parts = {search: ['?', 'query'], hash: ['#', 'fragment']};\n  generateAccessor = function(_part, _key){\n    return function(v, build) {\n      var t = this[_part](v, build);\n      return typeof t === 'string' && t.length ? (_key + t) : t;\n    };\n  };\n\n  for (_part in _parts) {\n    p[_part] = generateAccessor(_parts[_part][1], _parts[_part][0]);\n  }\n\n  p.pathname = function(v, build) {\n    if (v === undefined || v === true) {\n      var res = this._parts.path || (this._parts.hostname ? '/' : '');\n      return v ? URI.decodePath(res) : res;\n    } else {\n      this._parts.path = v ? URI.recodePath(v) : '/';\n      this.build(!build);\n      return this;\n    }\n  };\n  p.path = p.pathname;\n  p.href = function(href, build) {\n    var key;\n\n    if (href === undefined) {\n      return this.toString();\n    }\n\n    this._string = '';\n    this._parts = URI._parts();\n\n    var _URI = href instanceof URI;\n    var _object = typeof href === 'object' && (href.hostname || href.path || href.pathname);\n    if (href.nodeName) {\n      var attribute = URI.getDomAttribute(href);\n      href = href[attribute] || '';\n      _object = false;\n    }\n\n    // window.location is reported to be an object, but it's not the sort\n    // of object we're looking for:\n    // * location.protocol ends with a colon\n    // * location.query != object.search\n    // * location.hash != object.fragment\n    // simply serializing the unknown object should do the trick\n    // (for location, not for everything...)\n    if (!_URI && _object && href.pathname !== undefined) {\n      href = href.toString();\n    }\n\n    if (typeof href === 'string') {\n      this._parts = URI.parse(href, this._parts);\n    } else if (_URI || _object) {\n      var src = _URI ? href._parts : href;\n      for (key in src) {\n        if (hasOwn.call(this._parts, key)) {\n          this._parts[key] = src[key];\n        }\n      }\n    } else {\n      throw new TypeError('invalid input');\n    }\n\n    this.build(!build);\n    return this;\n  };\n\n  // identification accessors\n  p.is = function(what) {\n    var ip = false;\n    var ip4 = false;\n    var ip6 = false;\n    var name = false;\n    var sld = false;\n    var idn = false;\n    var punycode = false;\n    var relative = !this._parts.urn;\n\n    if (this._parts.hostname) {\n      relative = false;\n      ip4 = URI.ip4_expression.test(this._parts.hostname);\n      ip6 = URI.ip6_expression.test(this._parts.hostname);\n      ip = ip4 || ip6;\n      name = !ip;\n      sld = name && SLD && SLD.has(this._parts.hostname);\n      idn = name && URI.idn_expression.test(this._parts.hostname);\n      punycode = name && URI.punycode_expression.test(this._parts.hostname);\n    }\n\n    switch (what.toLowerCase()) {\n      case 'relative':\n        return relative;\n\n      case 'absolute':\n        return !relative;\n\n      // hostname identification\n      case 'domain':\n      case 'name':\n        return name;\n\n      case 'sld':\n        return sld;\n\n      case 'ip':\n        return ip;\n\n      case 'ip4':\n      case 'ipv4':\n      case 'inet4':\n        return ip4;\n\n      case 'ip6':\n      case 'ipv6':\n      case 'inet6':\n        return ip6;\n\n      case 'idn':\n        return idn;\n\n      case 'url':\n        return !this._parts.urn;\n\n      case 'urn':\n        return !!this._parts.urn;\n\n      case 'punycode':\n        return punycode;\n    }\n\n    return null;\n  };\n\n  // component specific input validation\n  var _protocol = p.protocol;\n  var _port = p.port;\n  var _hostname = p.hostname;\n\n  p.protocol = function(v, build) {\n    if (v !== undefined) {\n      if (v) {\n        // accept trailing ://\n        v = v.replace(/:(\\/\\/)?$/, '');\n\n        if (!v.match(URI.protocol_expression)) {\n          throw new TypeError('Protocol \"' + v + '\" contains characters other than [A-Z0-9.+-] or doesn\\'t start with [A-Z]');\n        }\n      }\n    }\n    return _protocol.call(this, v, build);\n  };\n  p.scheme = p.protocol;\n  p.port = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v !== undefined) {\n      if (v === 0) {\n        v = null;\n      }\n\n      if (v) {\n        v += '';\n        if (v.charAt(0) === ':') {\n          v = v.substring(1);\n        }\n\n        if (v.match(/[^0-9]/)) {\n          throw new TypeError('Port \"' + v + '\" contains characters other than [0-9]');\n        }\n      }\n    }\n    return _port.call(this, v, build);\n  };\n  p.hostname = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v !== undefined) {\n      var x = {};\n      URI.parseHost(v, x);\n      v = x.hostname;\n    }\n    return _hostname.call(this, v, build);\n  };\n\n  // compound accessors\n  p.host = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined) {\n      return this._parts.hostname ? URI.buildHost(this._parts) : '';\n    } else {\n      URI.parseHost(v, this._parts);\n      this.build(!build);\n      return this;\n    }\n  };\n  p.authority = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined) {\n      return this._parts.hostname ? URI.buildAuthority(this._parts) : '';\n    } else {\n      URI.parseAuthority(v, this._parts);\n      this.build(!build);\n      return this;\n    }\n  };\n  p.userinfo = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined) {\n      if (!this._parts.username) {\n        return '';\n      }\n\n      var t = URI.buildUserinfo(this._parts);\n      return t.substring(0, t.length -1);\n    } else {\n      if (v[v.length-1] !== '@') {\n        v += '@';\n      }\n\n      URI.parseUserinfo(v, this._parts);\n      this.build(!build);\n      return this;\n    }\n  };\n  p.resource = function(v, build) {\n    var parts;\n\n    if (v === undefined) {\n      return this.path() + this.search() + this.hash();\n    }\n\n    parts = URI.parse(v);\n    this._parts.path = parts.path;\n    this._parts.query = parts.query;\n    this._parts.fragment = parts.fragment;\n    this.build(!build);\n    return this;\n  };\n\n  // fraction accessors\n  p.subdomain = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    // convenience, return \"www\" from \"www.example.org\"\n    if (v === undefined) {\n      if (!this._parts.hostname || this.is('IP')) {\n        return '';\n      }\n\n      // grab domain and add another segment\n      var end = this._parts.hostname.length - this.domain().length - 1;\n      return this._parts.hostname.substring(0, end) || '';\n    } else {\n      var e = this._parts.hostname.length - this.domain().length;\n      var sub = this._parts.hostname.substring(0, e);\n      var replace = new RegExp('^' + escapeRegEx(sub));\n\n      if (v && v.charAt(v.length - 1) !== '.') {\n        v += '.';\n      }\n\n      if (v) {\n        URI.ensureValidHostname(v);\n      }\n\n      this._parts.hostname = this._parts.hostname.replace(replace, v);\n      this.build(!build);\n      return this;\n    }\n  };\n  p.domain = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (typeof v === 'boolean') {\n      build = v;\n      v = undefined;\n    }\n\n    // convenience, return \"example.org\" from \"www.example.org\"\n    if (v === undefined) {\n      if (!this._parts.hostname || this.is('IP')) {\n        return '';\n      }\n\n      // if hostname consists of 1 or 2 segments, it must be the domain\n      var t = this._parts.hostname.match(/\\./g);\n      if (t && t.length < 2) {\n        return this._parts.hostname;\n      }\n\n      // grab tld and add another segment\n      var end = this._parts.hostname.length - this.tld(build).length - 1;\n      end = this._parts.hostname.lastIndexOf('.', end -1) + 1;\n      return this._parts.hostname.substring(end) || '';\n    } else {\n      if (!v) {\n        throw new TypeError('cannot set domain empty');\n      }\n\n      URI.ensureValidHostname(v);\n\n      if (!this._parts.hostname || this.is('IP')) {\n        this._parts.hostname = v;\n      } else {\n        var replace = new RegExp(escapeRegEx(this.domain()) + '$');\n        this._parts.hostname = this._parts.hostname.replace(replace, v);\n      }\n\n      this.build(!build);\n      return this;\n    }\n  };\n  p.tld = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (typeof v === 'boolean') {\n      build = v;\n      v = undefined;\n    }\n\n    // return \"org\" from \"www.example.org\"\n    if (v === undefined) {\n      if (!this._parts.hostname || this.is('IP')) {\n        return '';\n      }\n\n      var pos = this._parts.hostname.lastIndexOf('.');\n      var tld = this._parts.hostname.substring(pos + 1);\n\n      if (build !== true && SLD && SLD.list[tld.toLowerCase()]) {\n        return SLD.get(this._parts.hostname) || tld;\n      }\n\n      return tld;\n    } else {\n      var replace;\n\n      if (!v) {\n        throw new TypeError('cannot set TLD empty');\n      } else if (v.match(/[^a-zA-Z0-9-]/)) {\n        if (SLD && SLD.is(v)) {\n          replace = new RegExp(escapeRegEx(this.tld()) + '$');\n          this._parts.hostname = this._parts.hostname.replace(replace, v);\n        } else {\n          throw new TypeError('TLD \"' + v + '\" contains characters other than [A-Z0-9]');\n        }\n      } else if (!this._parts.hostname || this.is('IP')) {\n        throw new ReferenceError('cannot set TLD on non-domain host');\n      } else {\n        replace = new RegExp(escapeRegEx(this.tld()) + '$');\n        this._parts.hostname = this._parts.hostname.replace(replace, v);\n      }\n\n      this.build(!build);\n      return this;\n    }\n  };\n  p.directory = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined || v === true) {\n      if (!this._parts.path && !this._parts.hostname) {\n        return '';\n      }\n\n      if (this._parts.path === '/') {\n        return '/';\n      }\n\n      var end = this._parts.path.length - this.filename().length - 1;\n      var res = this._parts.path.substring(0, end) || (this._parts.hostname ? '/' : '');\n\n      return v ? URI.decodePath(res) : res;\n\n    } else {\n      var e = this._parts.path.length - this.filename().length;\n      var directory = this._parts.path.substring(0, e);\n      var replace = new RegExp('^' + escapeRegEx(directory));\n\n      // fully qualifier directories begin with a slash\n      if (!this.is('relative')) {\n        if (!v) {\n          v = '/';\n        }\n\n        if (v.charAt(0) !== '/') {\n          v = '/' + v;\n        }\n      }\n\n      // directories always end with a slash\n      if (v && v.charAt(v.length - 1) !== '/') {\n        v += '/';\n      }\n\n      v = URI.recodePath(v);\n      this._parts.path = this._parts.path.replace(replace, v);\n      this.build(!build);\n      return this;\n    }\n  };\n  p.filename = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined || v === true) {\n      if (!this._parts.path || this._parts.path === '/') {\n        return '';\n      }\n\n      var pos = this._parts.path.lastIndexOf('/');\n      var res = this._parts.path.substring(pos+1);\n\n      return v ? URI.decodePathSegment(res) : res;\n    } else {\n      var mutatedDirectory = false;\n\n      if (v.charAt(0) === '/') {\n        v = v.substring(1);\n      }\n\n      if (v.match(/\\.?\\//)) {\n        mutatedDirectory = true;\n      }\n\n      var replace = new RegExp(escapeRegEx(this.filename()) + '$');\n      v = URI.recodePath(v);\n      this._parts.path = this._parts.path.replace(replace, v);\n\n      if (mutatedDirectory) {\n        this.normalizePath(build);\n      } else {\n        this.build(!build);\n      }\n\n      return this;\n    }\n  };\n  p.suffix = function(v, build) {\n    if (this._parts.urn) {\n      return v === undefined ? '' : this;\n    }\n\n    if (v === undefined || v === true) {\n      if (!this._parts.path || this._parts.path === '/') {\n        return '';\n      }\n\n      var filename = this.filename();\n      var pos = filename.lastIndexOf('.');\n      var s, res;\n\n      if (pos === -1) {\n        return '';\n      }\n\n      // suffix may only contain alnum characters (yup, I made this up.)\n      s = filename.substring(pos+1);\n      res = (/^[a-z0-9%]+$/i).test(s) ? s : '';\n      return v ? URI.decodePathSegment(res) : res;\n    } else {\n      if (v.charAt(0) === '.') {\n        v = v.substring(1);\n      }\n\n      var suffix = this.suffix();\n      var replace;\n\n      if (!suffix) {\n        if (!v) {\n          return this;\n        }\n\n        this._parts.path += '.' + URI.recodePath(v);\n      } else if (!v) {\n        replace = new RegExp(escapeRegEx('.' + suffix) + '$');\n      } else {\n        replace = new RegExp(escapeRegEx(suffix) + '$');\n      }\n\n      if (replace) {\n        v = URI.recodePath(v);\n        this._parts.path = this._parts.path.replace(replace, v);\n      }\n\n      this.build(!build);\n      return this;\n    }\n  };\n  p.segment = function(segment, v, build) {\n    var separator = this._parts.urn ? ':' : '/';\n    var path = this.path();\n    var absolute = path.substring(0, 1) === '/';\n    var segments = path.split(separator);\n\n    if (segment !== undefined && typeof segment !== 'number') {\n      build = v;\n      v = segment;\n      segment = undefined;\n    }\n\n    if (segment !== undefined && typeof segment !== 'number') {\n      throw new Error('Bad segment \"' + segment + '\", must be 0-based integer');\n    }\n\n    if (absolute) {\n      segments.shift();\n    }\n\n    if (segment < 0) {\n      // allow negative indexes to address from the end\n      segment = Math.max(segments.length + segment, 0);\n    }\n\n    if (v === undefined) {\n      /*jshint laxbreak: true */\n      return segment === undefined\n        ? segments\n        : segments[segment];\n      /*jshint laxbreak: false */\n    } else if (segment === null || segments[segment] === undefined) {\n      if (isArray(v)) {\n        segments = [];\n        // collapse empty elements within array\n        for (var i=0, l=v.length; i < l; i++) {\n          if (!v[i].length && (!segments.length || !segments[segments.length -1].length)) {\n            continue;\n          }\n\n          if (segments.length && !segments[segments.length -1].length) {\n            segments.pop();\n          }\n\n          segments.push(v[i]);\n        }\n      } else if (v || (typeof v === 'string')) {\n        if (segments[segments.length -1] === '') {\n          // empty trailing elements have to be overwritten\n          // to prevent results such as /foo//bar\n          segments[segments.length -1] = v;\n        } else {\n          segments.push(v);\n        }\n      }\n    } else {\n      if (v || (typeof v === 'string' && v.length)) {\n        segments[segment] = v;\n      } else {\n        segments.splice(segment, 1);\n      }\n    }\n\n    if (absolute) {\n      segments.unshift('');\n    }\n\n    return this.path(segments.join(separator), build);\n  };\n  p.segmentCoded = function(segment, v, build) {\n    var segments, i, l;\n\n    if (typeof segment !== 'number') {\n      build = v;\n      v = segment;\n      segment = undefined;\n    }\n\n    if (v === undefined) {\n      segments = this.segment(segment, v, build);\n      if (!isArray(segments)) {\n        segments = segments !== undefined ? URI.decode(segments) : undefined;\n      } else {\n        for (i = 0, l = segments.length; i < l; i++) {\n          segments[i] = URI.decode(segments[i]);\n        }\n      }\n\n      return segments;\n    }\n\n    if (!isArray(v)) {\n      v = typeof v === 'string' ? URI.encode(v) : v;\n    } else {\n      for (i = 0, l = v.length; i < l; i++) {\n        v[i] = URI.decode(v[i]);\n      }\n    }\n\n    return this.segment(segment, v, build);\n  };\n\n  // mutating query string\n  var q = p.query;\n  p.query = function(v, build) {\n    if (v === true) {\n      return URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n    } else if (typeof v === 'function') {\n      var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n      var result = v.call(this, data);\n      this._parts.query = URI.buildQuery(result || data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n      this.build(!build);\n      return this;\n    } else if (v !== undefined && typeof v !== 'string') {\n      this._parts.query = URI.buildQuery(v, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n      this.build(!build);\n      return this;\n    } else {\n      return q.call(this, v, build);\n    }\n  };\n  p.setQuery = function(name, value, build) {\n    var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n\n    if (typeof name === 'object') {\n      for (var key in name) {\n        if (hasOwn.call(name, key)) {\n          data[key] = name[key];\n        }\n      }\n    } else if (typeof name === 'string') {\n      data[name] = value !== undefined ? value : null;\n    } else {\n      throw new TypeError('URI.addQuery() accepts an object, string as the name parameter');\n    }\n\n    this._parts.query = URI.buildQuery(data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n    if (typeof name !== 'string') {\n      build = value;\n    }\n\n    this.build(!build);\n    return this;\n  };\n  p.addQuery = function(name, value, build) {\n    var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n    URI.addQuery(data, name, value === undefined ? null : value);\n    this._parts.query = URI.buildQuery(data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n    if (typeof name !== 'string') {\n      build = value;\n    }\n\n    this.build(!build);\n    return this;\n  };\n  p.removeQuery = function(name, value, build) {\n    var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n    URI.removeQuery(data, name, value);\n    this._parts.query = URI.buildQuery(data, this._parts.duplicateQueryParameters, this._parts.escapeQuerySpace);\n    if (typeof name !== 'string') {\n      build = value;\n    }\n\n    this.build(!build);\n    return this;\n  };\n  p.hasQuery = function(name, value, withinArray) {\n    var data = URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace);\n    return URI.hasQuery(data, name, value, withinArray);\n  };\n  p.setSearch = p.setQuery;\n  p.addSearch = p.addQuery;\n  p.removeSearch = p.removeQuery;\n  p.hasSearch = p.hasQuery;\n\n  // sanitizing URLs\n  p.normalize = function() {\n    if (this._parts.urn) {\n      return this\n        .normalizeProtocol(false)\n        .normalizeQuery(false)\n        .normalizeFragment(false)\n        .build();\n    }\n\n    return this\n      .normalizeProtocol(false)\n      .normalizeHostname(false)\n      .normalizePort(false)\n      .normalizePath(false)\n      .normalizeQuery(false)\n      .normalizeFragment(false)\n      .build();\n  };\n  p.normalizeProtocol = function(build) {\n    if (typeof this._parts.protocol === 'string') {\n      this._parts.protocol = this._parts.protocol.toLowerCase();\n      this.build(!build);\n    }\n\n    return this;\n  };\n  p.normalizeHostname = function(build) {\n    if (this._parts.hostname) {\n      if (this.is('IDN') && punycode) {\n        this._parts.hostname = punycode.toASCII(this._parts.hostname);\n      } else if (this.is('IPv6') && IPv6) {\n        this._parts.hostname = IPv6.best(this._parts.hostname);\n      }\n\n      this._parts.hostname = this._parts.hostname.toLowerCase();\n      this.build(!build);\n    }\n\n    return this;\n  };\n  p.normalizePort = function(build) {\n    // remove port of it's the protocol's default\n    if (typeof this._parts.protocol === 'string' && this._parts.port === URI.defaultPorts[this._parts.protocol]) {\n      this._parts.port = null;\n      this.build(!build);\n    }\n\n    return this;\n  };\n  p.normalizePath = function(build) {\n    if (this._parts.urn) {\n      return this;\n    }\n\n    if (!this._parts.path || this._parts.path === '/') {\n      return this;\n    }\n\n    var _was_relative;\n    var _path = this._parts.path;\n    var _leadingParents = '';\n    var _parent, _pos;\n\n    // handle relative paths\n    if (_path.charAt(0) !== '/') {\n      _was_relative = true;\n      _path = '/' + _path;\n    }\n\n    // resolve simples\n    _path = _path\n      .replace(/(\\/(\\.\\/)+)|(\\/\\.$)/g, '/')\n      .replace(/\\/{2,}/g, '/');\n\n    // remember leading parents\n    if (_was_relative) {\n      _leadingParents = _path.substring(1).match(/^(\\.\\.\\/)+/) || '';\n      if (_leadingParents) {\n        _leadingParents = _leadingParents[0];\n      }\n    }\n\n    // resolve parents\n    while (true) {\n      _parent = _path.indexOf('/..');\n      if (_parent === -1) {\n        // no more ../ to resolve\n        break;\n      } else if (_parent === 0) {\n        // top level cannot be relative, skip it\n        _path = _path.substring(3);\n        continue;\n      }\n\n      _pos = _path.substring(0, _parent).lastIndexOf('/');\n      if (_pos === -1) {\n        _pos = _parent;\n      }\n      _path = _path.substring(0, _pos) + _path.substring(_parent + 3);\n    }\n\n    // revert to relative\n    if (_was_relative && this.is('relative')) {\n      _path = _leadingParents + _path.substring(1);\n    }\n\n    _path = URI.recodePath(_path);\n    this._parts.path = _path;\n    this.build(!build);\n    return this;\n  };\n  p.normalizePathname = p.normalizePath;\n  p.normalizeQuery = function(build) {\n    if (typeof this._parts.query === 'string') {\n      if (!this._parts.query.length) {\n        this._parts.query = null;\n      } else {\n        this.query(URI.parseQuery(this._parts.query, this._parts.escapeQuerySpace));\n      }\n\n      this.build(!build);\n    }\n\n    return this;\n  };\n  p.normalizeFragment = function(build) {\n    if (!this._parts.fragment) {\n      this._parts.fragment = null;\n      this.build(!build);\n    }\n\n    return this;\n  };\n  p.normalizeSearch = p.normalizeQuery;\n  p.normalizeHash = p.normalizeFragment;\n\n  p.iso8859 = function() {\n    // expect unicode input, iso8859 output\n    var e = URI.encode;\n    var d = URI.decode;\n\n    URI.encode = escape;\n    URI.decode = decodeURIComponent;\n    this.normalize();\n    URI.encode = e;\n    URI.decode = d;\n    return this;\n  };\n\n  p.unicode = function() {\n    // expect iso8859 input, unicode output\n    var e = URI.encode;\n    var d = URI.decode;\n\n    URI.encode = strictEncodeURIComponent;\n    URI.decode = unescape;\n    this.normalize();\n    URI.encode = e;\n    URI.decode = d;\n    return this;\n  };\n\n  p.readable = function() {\n    var uri = this.clone();\n    // removing username, password, because they shouldn't be displayed according to RFC 3986\n    uri.username('').password('').normalize();\n    var t = '';\n    if (uri._parts.protocol) {\n      t += uri._parts.protocol + '://';\n    }\n\n    if (uri._parts.hostname) {\n      if (uri.is('punycode') && punycode) {\n        t += punycode.toUnicode(uri._parts.hostname);\n        if (uri._parts.port) {\n          t += ':' + uri._parts.port;\n        }\n      } else {\n        t += uri.host();\n      }\n    }\n\n    if (uri._parts.hostname && uri._parts.path && uri._parts.path.charAt(0) !== '/') {\n      t += '/';\n    }\n\n    t += uri.path(true);\n    if (uri._parts.query) {\n      var q = '';\n      for (var i = 0, qp = uri._parts.query.split('&'), l = qp.length; i < l; i++) {\n        var kv = (qp[i] || '').split('=');\n        q += '&' + URI.decodeQuery(kv[0], this._parts.escapeQuerySpace)\n          .replace(/&/g, '%26');\n\n        if (kv[1] !== undefined) {\n          q += '=' + URI.decodeQuery(kv[1], this._parts.escapeQuerySpace)\n            .replace(/&/g, '%26');\n        }\n      }\n      t += '?' + q.substring(1);\n    }\n\n    t += URI.decodeQuery(uri.hash(), true);\n    return t;\n  };\n\n  // resolving relative and absolute URLs\n  p.absoluteTo = function(base) {\n    var resolved = this.clone();\n    var properties = ['protocol', 'username', 'password', 'hostname', 'port'];\n    var basedir, i, p;\n\n    if (this._parts.urn) {\n      throw new Error('URNs do not have any generally defined hierarchical components');\n    }\n\n    if (!(base instanceof URI)) {\n      base = new URI(base);\n    }\n\n    if (!resolved._parts.protocol) {\n      resolved._parts.protocol = base._parts.protocol;\n    }\n\n    if (this._parts.hostname) {\n      return resolved;\n    }\n\n    for (i = 0; (p = properties[i]); i++) {\n      resolved._parts[p] = base._parts[p];\n    }\n\n    if (!resolved._parts.path) {\n      resolved._parts.path = base._parts.path;\n      if (!resolved._parts.query) {\n        resolved._parts.query = base._parts.query;\n      }\n    } else if (resolved._parts.path.substring(-2) === '..') {\n      resolved._parts.path += '/';\n    }\n\n    if (resolved.path().charAt(0) !== '/') {\n      basedir = base.directory();\n      resolved._parts.path = (basedir ? (basedir + '/') : '') + resolved._parts.path;\n      resolved.normalizePath();\n    }\n\n    resolved.build();\n    return resolved;\n  };\n  p.relativeTo = function(base) {\n    var relative = this.clone().normalize();\n    var relativeParts, baseParts, common, relativePath, basePath;\n\n    if (relative._parts.urn) {\n      throw new Error('URNs do not have any generally defined hierarchical components');\n    }\n\n    base = new URI(base).normalize();\n    relativeParts = relative._parts;\n    baseParts = base._parts;\n    relativePath = relative.path();\n    basePath = base.path();\n\n    if (relativePath.charAt(0) !== '/') {\n      throw new Error('URI is already relative');\n    }\n\n    if (basePath.charAt(0) !== '/') {\n      throw new Error('Cannot calculate a URI relative to another relative URI');\n    }\n\n    if (relativeParts.protocol === baseParts.protocol) {\n      relativeParts.protocol = null;\n    }\n\n    if (relativeParts.username !== baseParts.username || relativeParts.password !== baseParts.password) {\n      return relative.build();\n    }\n\n    if (relativeParts.protocol !== null || relativeParts.username !== null || relativeParts.password !== null) {\n      return relative.build();\n    }\n\n    if (relativeParts.hostname === baseParts.hostname && relativeParts.port === baseParts.port) {\n      relativeParts.hostname = null;\n      relativeParts.port = null;\n    } else {\n      return relative.build();\n    }\n\n    if (relativePath === basePath) {\n      relativeParts.path = '';\n      return relative.build();\n    }\n\n    // determine common sub path\n    common = URI.commonPath(relative.path(), base.path());\n\n    // If the paths have nothing in common, return a relative URL with the absolute path.\n    if (!common) {\n      return relative.build();\n    }\n\n    var parents = baseParts.path\n      .substring(common.length)\n      .replace(/[^\\/]*$/, '')\n      .replace(/.*?\\//g, '../');\n\n    relativeParts.path = parents + relativeParts.path.substring(common.length);\n\n    return relative.build();\n  };\n\n  // comparing URIs\n  p.equals = function(uri) {\n    var one = this.clone();\n    var two = new URI(uri);\n    var one_map = {};\n    var two_map = {};\n    var checked = {};\n    var one_query, two_query, key;\n\n    one.normalize();\n    two.normalize();\n\n    // exact match\n    if (one.toString() === two.toString()) {\n      return true;\n    }\n\n    // extract query string\n    one_query = one.query();\n    two_query = two.query();\n    one.query('');\n    two.query('');\n\n    // definitely not equal if not even non-query parts match\n    if (one.toString() !== two.toString()) {\n      return false;\n    }\n\n    // query parameters have the same length, even if they're permuted\n    if (one_query.length !== two_query.length) {\n      return false;\n    }\n\n    one_map = URI.parseQuery(one_query, this._parts.escapeQuerySpace);\n    two_map = URI.parseQuery(two_query, this._parts.escapeQuerySpace);\n\n    for (key in one_map) {\n      if (hasOwn.call(one_map, key)) {\n        if (!isArray(one_map[key])) {\n          if (one_map[key] !== two_map[key]) {\n            return false;\n          }\n        } else if (!arraysEqual(one_map[key], two_map[key])) {\n          return false;\n        }\n\n        checked[key] = true;\n      }\n    }\n\n    for (key in two_map) {\n      if (hasOwn.call(two_map, key)) {\n        if (!checked[key]) {\n          // two contains a parameter not present in one\n          return false;\n        }\n      }\n    }\n\n    return true;\n  };\n\n  // state\n  p.duplicateQueryParameters = function(v) {\n    this._parts.duplicateQueryParameters = !!v;\n    return this;\n  };\n\n  p.escapeQuerySpace = function(v) {\n    this._parts.escapeQuerySpace = !!v;\n    return this;\n  };\n\n  return URI;\n}));\n\n\"use strict\";\n\nangular.module(\"wixAngularExperiments\", []);\n\nangular.module(\"wixAngularPermissions\", []);\n\nangular.module(\"wixAngularBackwardCompatibility\", [ \"wixAngularAppInternal\", \"wixAngularExperiments\" ]);\n\nangular.module(\"wixAngularStorage\", [ \"wixAngularAppInternal\" ]);\n\nangular.module(\"wixAngularStorageHub\", [ \"wixAngularStorage\" ]);\n\nangular.module(\"wixAngularAppInternal\", []);\n\nangular.module(\"wixAngularInterceptor\", [ \"wixAngularAppInternal\" ]).config([ \"$httpProvider\", \"wixAngularTopologyProvider\", function($httpProvider, wixAngularTopologyProvider) {\n    $httpProvider.interceptors.push(\"wixAngularInterceptor\");\n    if (!wixAngularTopologyProvider.getStaticsUrl()) {\n        wixAngularTopologyProvider.setStaticsUrl(angular.element(document).find(\"base\").attr(\"href\"));\n    }\n} ]);\n\nangular.module(\"wixAngularTranslateCompile\", [ \"pascalprecht.translate\" ]);\n\nangular.module(\"wixAngular\", [ \"wixAngularAppInternal\", \"wixAngularTranslateCompile\", \"wixAngularStorage\", \"wixAngularExperiments\", \"wixAngularInterceptor\", \"wixAngularBackwardCompatibility\", \"wixAngularPermissions\" ]);\n\n\"use strict\";\n\nangular.module(\"wixAngularStorage\").constant(\"ANGULAR_STORAGE_PREFIX\", \"wixAngularStorage\").constant(\"KEY_SEPARATOR\", \"|\").constant(\"DEFAULT_AGE_IN_SEC\", 60 * 60).constant(\"CLEANING_INTERVAL\", 1e3 * 60 * 10).constant(\"CLEAN_EPSILON\", 100).constant(\"MAX_KEY_LENGTH\", 100).constant(\"MAX_VALUE_SIZE_IN_BYTES\", 4 * 1024).constant(\"MAX_AGE_IN_SEC\", 60 * 60 * 24 * 2).constant(\"MAX_STORAGE_SIZE_IN_BYTES\", 1024 * 1024).constant(\"DATA_TYPE\", \"data\").constant(\"ADHOC_TYPE\", \"adhoc\").constant(\"REMOTE_TYPE\", \"remote\").constant(\"LOCAL_STORAGE_FRAME_ID\", \"wixCacheFrame\").constant(\"wixAngularStorageErrors\", {\n    LOGGED_OUT: 1,\n    NOT_FOUND: 2,\n    RUNTIME_EXCEPTION: 3,\n    SERVER_ERROR: 4,\n    QUOTA_EXCEEDED: 5\n});\n\n\"use strict\";\n\n(function() {\n    function WixAngularStorageController(wixCache, wixStorage) {\n        var that = this;\n        function getOptions() {\n            return {\n                siteId: that.siteId,\n                noCache: that.noCache\n            };\n        }\n        var writeData = function(res) {\n            that.data = res;\n        };\n        var eraseData = function() {\n            that.data = null;\n        };\n        this.cache = {\n            set: function(key, data) {\n                wixCache.set(key, data, getOptions());\n            },\n            setWithGUID: function(data) {\n                wixCache.setWithGUID(data).then(function(key) {\n                    that.key = key;\n                });\n            },\n            get: function(key) {\n                wixCache.get(key, getOptions()).then(writeData, eraseData);\n            },\n            remove: function(key) {\n                wixCache.remove(key, getOptions()).then(eraseData);\n            }\n        };\n        this.remote = {\n            set: function(key, value) {\n                wixStorage.set(key, value, getOptions());\n            },\n            get: function(key) {\n                wixStorage.get(key, getOptions()).then(writeData, eraseData);\n            },\n            remove: function(key) {\n                wixStorage.remove(key, getOptions()).then(eraseData);\n            }\n        };\n    }\n    WixAngularStorageController.$inject = [ \"wixCache\", \"wixStorage\" ];\n    angular.module(\"wixAngularAppInternal\").controller(\"WixAngularStorageController\", WixAngularStorageController);\n})();\n\n\"use strict\";\n\n(function() {\n    function wixTranslateCompile($translate, $compile, $parse) {\n        return {\n            restrict: \"A\",\n            replace: true,\n            link: function(scope, element, attrs) {\n                var values = attrs.translateValues ? $parse(attrs.translateValues)(scope) : {};\n                var content = $translate(attrs.wixTranslateCompile, values);\n                element.html(content);\n                $compile(element.contents())(scope);\n            }\n        };\n    }\n    wixTranslateCompile.$inject = [ \"$translate\", \"$compile\", \"$parse\" ];\n    angular.module(\"wixAngularTranslateCompile\").directive(\"wixTranslateCompile\", wixTranslateCompile);\n})();\n\n\"use strict\";\n\n(function() {\n    function relativeHref(wixAngularTopology) {\n        return {\n            priority: 99,\n            link: function(scope, element, attr) {\n                attr.$observe(\"relativeHref\", function(url) {\n                    if (url) {\n                        attr.$set(\"href\", wixAngularTopology.staticsUrl + url);\n                    }\n                });\n            }\n        };\n    }\n    relativeHref.$inject = [ \"wixAngularTopology\" ];\n    angular.module(\"wixAngularAppInternal\").directive(\"relativeHref\", relativeHref);\n})();\n\n\"use strict\";\n\n(function() {\n    function relativeSrc(wixAngularTopology) {\n        return {\n            priority: 99,\n            link: function(scope, element, attr) {\n                attr.$observe(\"relativeSrc\", function(url) {\n                    if (url) {\n                        attr.$set(\"src\", url.indexOf(\"images/\") === 0 ? wixAngularTopology.staticsUrl + url : url);\n                    }\n                });\n            }\n        };\n    }\n    relativeSrc.$inject = [ \"wixAngularTopology\" ];\n    angular.module(\"wixAngularAppInternal\").directive(\"relativeSrc\", relativeSrc);\n})();\n\n\"use strict\";\n\n(function() {\n    function hookPreLink(link, fn) {\n        if (typeof link === \"function\") {\n            return {\n                pre: fn,\n                post: link\n            };\n        } else {\n            var hooked = link.pre;\n            link.pre = function() {\n                fn.apply(undefined, arguments);\n                return hooked.apply(undefined, arguments);\n            };\n            return link;\n        }\n    }\n    function wixManagersNgDirective(manager, ngDirective, directiveName, ngAttributeName) {\n        function parseNegation(expr) {\n            var negationGroups = /^(\\!*)([^!].*)/.exec(expr);\n            var negation = negationGroups[1];\n            var name = negationGroups[2];\n            var value = manager.contains(name);\n            return negation.length % 2 ? !value : value;\n        }\n        var ngDir = ngDirective[0];\n        var ddo = angular.copy(ngDir);\n        ddo.compile = function() {\n            var ret = ngDir.compile.apply(ngDir, arguments);\n            return hookPreLink(ret, function(scope, element, attr) {\n                attr[ngAttributeName] = function() {\n                    var expr = attr[directiveName];\n                    return parseNegation(expr);\n                };\n            });\n        };\n        return ddo;\n    }\n    wixManagersNgDirective.$inject = [ \"manager\", \"ngDirective\", \"directiveName\", \"ngAttributeName\" ];\n    function defineNgDirective($injector, manager, name, ngDirective, ngAttributeName) {\n        return $injector.invoke(wixManagersNgDirective, this, {\n            manager: manager,\n            directiveName: name,\n            ngDirective: ngDirective,\n            ngAttributeName: ngAttributeName\n        });\n    }\n    angular.module(\"wixAngularExperiments\").directive(\"wixExperimentIf\", [ \"$injector\", \"experimentManager\", \"ngIfDirective\", function($injector, experimentManager, ngIfDirective) {\n        return defineNgDirective($injector, experimentManager, \"wixExperimentIf\", ngIfDirective, \"ngIf\");\n    } ]);\n    angular.module(\"wixAngularPermissions\").directive(\"wixPermissionIf\", [ \"$injector\", \"permissionsManager\", \"ngIfDirective\", function($injector, permissionsManager, ngIfDirective) {\n        return defineNgDirective($injector, permissionsManager, \"wixPermissionIf\", ngIfDirective, \"ngIf\");\n    } ]);\n    angular.module(\"wixAngularExperiments\").directive(\"wixExperimentDisabled\", [ \"$injector\", \"experimentManager\", \"ngDisabledDirective\", function($injector, experimentManager, ngDisabledDirective) {\n        return defineNgDirective($injector, experimentManager, \"wixExperimentDisabled\", ngDisabledDirective, \"ngDisabled\");\n    } ]);\n    angular.module(\"wixAngularPermissions\").directive(\"wixPermissionDisabled\", [ \"$injector\", \"permissionsManager\", \"ngDisabledDirective\", function($injector, permissionsManager, ngDisabledDirective) {\n        return defineNgDirective($injector, permissionsManager, \"wixPermissionDisabled\", ngDisabledDirective, \"ngDisabled\");\n    } ]);\n})();\n\n\"use strict\";\n\n(function() {\n    function wixManagersClass(manager, directiveName, valuesToCheck, $parse) {\n        return {\n            restrict: \"A\",\n            link: function postLink(scope, element, attr) {\n                var values = $parse(attr[valuesToCheck])(scope);\n                var name = attr[directiveName];\n                if (values) {\n                    var classToAdd = values[manager.get(name)];\n                    if (classToAdd) {\n                        element.addClass(classToAdd);\n                    }\n                }\n            }\n        };\n    }\n    wixManagersClass.$inject = [ \"manager\", \"directiveName\", \"valuesToCheck\", \"$parse\" ];\n    function defineClassDirective($injector, manager, name, valuesToCheck) {\n        return $injector.invoke(wixManagersClass, this, {\n            manager: manager,\n            directiveName: name,\n            valuesToCheck: valuesToCheck\n        });\n    }\n    angular.module(\"wixAngularExperiments\").directive(\"wixExperimentClass\", [ \"$injector\", \"experimentManager\", function($injector, experimentManager) {\n        return defineClassDirective($injector, experimentManager, \"wixExperimentClass\", \"experimentValues\");\n    } ]);\n    angular.module(\"wixAngularPermissions\").directive(\"wixPermissionClass\", [ \"$injector\", \"permissionsManager\", function($injector, permissionsManager) {\n        return defineClassDirective($injector, permissionsManager, \"wixPermissionClass\", \"permissionValues\");\n    } ]);\n})();\n\n\"use strict\";\n\n(function() {\n    function wixAngularInterceptorFactory($q, wixCookies, $rootScope, wixAngularEvents, wixAngularTopology) {\n        var wixAngularInterceptor = {};\n        var firstUserSwitchTest = true;\n        var previousUserGUID;\n        function errorHandler(response) {\n            return $q.reject(response);\n        }\n        function checkUserSwitch() {\n            if (!firstUserSwitchTest && previousUserGUID !== wixCookies.userGUID) {\n                $rootScope.$emit(wixAngularEvents.userSwitch, wixCookies.userGUID, previousUserGUID);\n            }\n            previousUserGUID = wixCookies.userGUID;\n            firstUserSwitchTest = false;\n        }\n        wixAngularInterceptor.request = function(config) {\n            checkUserSwitch();\n            if (config.url.match(/\\.html$/)) {\n                if (!config.url.match(/(:|^)\\/\\//)) {\n                    if (!config.cache || !config.cache.get || !config.cache.get(config.url)) {\n                        config.url = wixAngularTopology.calcPartialsUrl(wixAngularTopology.staticsUrl) + config.url.replace(/^\\//, \"\");\n                    }\n                }\n            } else if (config.url.indexOf(\"/_api/\") === 0) {\n                config.url = wixAngularTopology.fixOrigin(config.url);\n            }\n            return config;\n        };\n        wixAngularInterceptor.response = function(response) {\n            if (response.data) {\n                if (response.data.success === false) {\n                    response.status = 500;\n                    return errorHandler(response);\n                } else if (response.data.success === true && response.data.payload !== undefined) {\n                    response.data = response.data.payload;\n                }\n            }\n            return response;\n        };\n        wixAngularInterceptor.responseError = function(response) {\n            return errorHandler(response);\n        };\n        return wixAngularInterceptor;\n    }\n    wixAngularInterceptorFactory.$inject = [ \"$q\", \"wixCookies\", \"$rootScope\", \"wixAngularEvents\", \"wixAngularTopology\" ];\n    angular.module(\"wixAngularAppInternal\").factory(\"wixAngularInterceptor\", wixAngularInterceptorFactory).constant(\"wixAngularEvents\", {\n        userSwitch: \"userSwitch\"\n    });\n})();\n\n\"use strict\";\n\n(function() {\n    function WixAngular(wixAngularTopologyProvider, experimentManagerProvider) {\n        this.getStaticsUrl = wixAngularTopologyProvider.getStaticsUrl;\n        this.setStaticsUrl = wixAngularTopologyProvider.setStaticsUrl;\n        var isExperimentEnabled = experimentManagerProvider.isExperimentEnabled.bind(experimentManagerProvider);\n        this.setExperiments = experimentManagerProvider.setExperiments.bind(experimentManagerProvider);\n        this.isExperimentEnabled = isExperimentEnabled;\n        this.$get = [ \"wixAngularTopology\", \"experimentManager\", function(wixAngularTopology, experimentManager) {\n            var wixAngular = {};\n            wixAngular.experiments = experimentManager.$$getExperimentsObj();\n            wixAngular.isExperimentEnabled = isExperimentEnabled;\n            wixAngular.fixOrigin = wixAngularTopology.fixOrigin;\n            wixAngular.staticsUrl = wixAngularTopology.staticsUrl;\n            wixAngular.partialsUrl = wixAngularTopology.partialsUrl;\n            return wixAngular;\n        } ];\n        this.$get.$inject = [ \"wixAngularTopology\", \"experimentManager\" ];\n    }\n    WixAngular.$inject = [ \"wixAngularTopologyProvider\", \"experimentManagerProvider\" ];\n    angular.module(\"wixAngularBackwardCompatibility\").provider(\"wixAngular\", WixAngular);\n})();\n\n\"use strict\";\n\n(function() {\n    function wixCacheFactory($q, recordUtils, crossStorage, wixAngularStorageErrors, DEFAULT_AGE_IN_SEC, DATA_TYPE, ADHOC_TYPE, REMOTE_TYPE, CLEAN_EPSILON) {\n        var wixCache = {};\n        function rejectWithRuntimeException() {\n            return $q.reject(wixAngularStorageErrors.RUNTIME_EXCEPTION);\n        }\n        function getCrossStorage() {\n            return crossStorage.onConnect().catch(rejectWithRuntimeException);\n        }\n        function tryToSet(key, value) {\n            var cacheKey = recordUtils.getCacheKey(key, value.options);\n            function returnKey() {\n                return key;\n            }\n            return getCrossStorage().then(function() {\n                return crossStorage.set(cacheKey, value);\n            }).then(returnKey, function(reason) {\n                if (reason === wixAngularStorageErrors.RUNTIME_EXCEPTION) {\n                    return rejectWithRuntimeException();\n                }\n                if (value.options.type === REMOTE_TYPE) {\n                    return $q.reject();\n                } else {\n                    return crossStorage.clear(recordUtils.getRecordSize(cacheKey, value) + CLEAN_EPSILON).then(function() {\n                        return crossStorage.set(cacheKey, value).then(returnKey, rejectWithRuntimeException);\n                    }, function() {\n                        return $q.reject(wixAngularStorageErrors.QUOTA_EXCEEDED);\n                    });\n                }\n            });\n        }\n        wixCache.set = function(key, data, options) {\n            recordUtils.validateKey(key);\n            recordUtils.validateData(data);\n            recordUtils.validateExpiration(options);\n            var value = {\n                createdAt: Date.now(),\n                data: data,\n                options: angular.extend({\n                    expiration: DEFAULT_AGE_IN_SEC,\n                    type: DATA_TYPE\n                }, options)\n            };\n            return tryToSet(key, value);\n        };\n        wixCache.setWithGUID = function(data) {\n            var key = recordUtils.generateRandomKey();\n            return this.set(key, data, {\n                expiration: null,\n                type: ADHOC_TYPE\n            });\n        };\n        wixCache.get = function(key, opts) {\n            return getCrossStorage().then(function() {\n                return crossStorage.get(recordUtils.getCacheKey(key, opts));\n            }).then(function(record) {\n                if (record && !recordUtils.isExpired(record)) {\n                    return record.data;\n                } else {\n                    return $q.reject(wixAngularStorageErrors.NOT_FOUND);\n                }\n            }, rejectWithRuntimeException);\n        };\n        wixCache.remove = function(key, opts) {\n            return getCrossStorage().then(function() {\n                return crossStorage.del(recordUtils.getCacheKey(key, opts));\n            }).catch(rejectWithRuntimeException);\n        };\n        if (!recordUtils.isUserLoggedIn()) {\n            wixCache.set = wixCache.get = wixCache.remove = function() {\n                return $q.reject(wixAngularStorageErrors.LOGGED_OUT);\n            };\n        }\n        return wixCache;\n    }\n    wixCacheFactory.$inject = [ \"$q\", \"recordUtils\", \"crossStorage\", \"wixAngularStorageErrors\", \"DEFAULT_AGE_IN_SEC\", \"DATA_TYPE\", \"ADHOC_TYPE\", \"REMOTE_TYPE\", \"CLEAN_EPSILON\" ];\n    angular.module(\"wixAngularStorage\").factory(\"wixCache\", wixCacheFactory);\n})();\n\n\"use strict\";\n\n(function() {\n    function wixCookiesFactory(cookieStr) {\n        var parsedUser, prevCookies;\n        function parseUserCookie(cookie) {\n            var cookieParts = cookie ? cookie.split(\"|\") : [];\n            return {\n                guid: cookieParts[6],\n                userName: cookieParts[0]\n            };\n        }\n        function parseAllCookies(cookies) {\n            return cookies.split(\";\").map(function(str) {\n                return str.trim();\n            }).reduce(function(acc, curr) {\n                var args = curr.split(\"=\");\n                acc[args[0]] = args[1];\n                return acc;\n            }, {});\n        }\n        function getParsedUserCookie() {\n            var cookies = cookieStr() || \"\";\n            if (cookies !== prevCookies) {\n                prevCookies = cookies;\n                parsedUser = parseUserCookie(parseAllCookies(cookies).wixClient);\n            }\n            return parsedUser;\n        }\n        return {\n            get userGUID() {\n                return getParsedUserCookie().guid;\n            },\n            get userName() {\n                return getParsedUserCookie().userName;\n            }\n        };\n    }\n    wixCookiesFactory.$inject = [ \"cookieStr\" ];\n    angular.module(\"wixAngularAppInternal\").factory(\"wixCookies\", wixCookiesFactory).factory(\"cookieStr\", [ \"$document\", function($document) {\n        return function() {\n            return $document[0] && $document[0].cookie || \"\";\n        };\n    } ]);\n})();\n\n\"use strict\";\n\n(function() {\n    function crossStorage($q, wixAngularTopology, LOCAL_STORAGE_FRAME_ID) {\n        function promiseCtor(resolver) {\n            var dfd = $q.defer();\n            resolver(dfd.resolve, dfd.reject);\n            return dfd.promise;\n        }\n        promiseCtor.resolve = function() {\n            return $q.when(true);\n        };\n        promiseCtor.reject = $q.reject;\n        CrossStorageClient.prototype.clear = function(amount) {\n            return this._request(\"clear\", {\n                amount: amount\n            });\n        };\n        return new CrossStorageClient(wixAngularTopology.staticsUrl.replace(\".parastaging.com\", \".wixpress.com\").replace(\".parastorage.com\", \".wix.com\").replace(\"//static.\", \"//sslstatic.\") + \"bower_components/wix-angular/dist/views/cross-storage.html\", {\n            frameId: LOCAL_STORAGE_FRAME_ID,\n            promise: promiseCtor\n        });\n    }\n    crossStorage.$inject = [ \"$q\", \"wixAngularTopology\", \"LOCAL_STORAGE_FRAME_ID\" ];\n    angular.module(\"wixAngularStorage\").factory(\"crossStorage\", crossStorage);\n})();\n\n\"use strict\";\n\n(function() {\n    function crossStorageCleanerFactory($window, $interval, recordUtils, MAX_STORAGE_SIZE_IN_BYTES, CLEANING_INTERVAL, DATA_TYPE) {\n        var hub = $window.CrossStorageHub;\n        var init = hub.init;\n        var _set = hub._set;\n        var dataKeys = [];\n        var remoteAndAdhocKeys = [];\n        function removeFromArray(item, arr) {\n            var itemIndex = arr.indexOf(item);\n            if (itemIndex !== -1) {\n                arr.splice(itemIndex, 1);\n            }\n        }\n        function chooseArrayByType(options) {\n            return options.type === DATA_TYPE ? dataKeys : remoteAndAdhocKeys;\n        }\n        function clearRecord(key) {\n            var record = hub._get({\n                keys: [ key ]\n            });\n            if (record) {\n                var recordSize = recordUtils.getRecordSize(key, record);\n                hub._del({\n                    keys: [ key ]\n                });\n                return recordSize;\n            } else {\n                return 0;\n            }\n        }\n        function clearRecords(keys) {\n            return keys.reduce(function(acc, key) {\n                acc += clearRecord(key);\n                return acc;\n            }, 0);\n        }\n        function getWixCacheKeys() {\n            return hub._getKeys().filter(recordUtils.hasPrefix);\n        }\n        function getWixCacheSize() {\n            return getWixCacheKeys().reduce(function(acc, key) {\n                return acc + recordUtils.getRecordSize(key, hub._get({\n                    keys: [ key ]\n                }));\n            }, 0);\n        }\n        function loadExistingWixCacheKeys() {\n            var createdAtSort = function(a, b) {\n                return a.createdAt - b.createdAt;\n            };\n            var getKey = function(item) {\n                return item.key;\n            };\n            getWixCacheKeys().forEach(function(key) {\n                var item = hub._get({\n                    keys: [ key ]\n                });\n                var arr = chooseArrayByType(item.options);\n                arr.push({\n                    key: key,\n                    createdAt: item.createdAt\n                });\n            });\n            dataKeys.sort(createdAtSort);\n            remoteAndAdhocKeys.sort(createdAtSort);\n            dataKeys = dataKeys.map(getKey);\n            remoteAndAdhocKeys = remoteAndAdhocKeys.map(getKey);\n        }\n        function decorateInit(permissions) {\n            dataKeys.length = 0;\n            remoteAndAdhocKeys.length = 0;\n            loadExistingWixCacheKeys();\n            hub._clear();\n            init(permissions);\n            $interval(hub._clear.bind(hub), CLEANING_INTERVAL);\n        }\n        function decorateSet(params) {\n            var arr = chooseArrayByType(params.value.options);\n            removeFromArray(params.key, arr);\n            arr.push(params.key);\n            _set(params);\n        }\n        function clearOtherUsers() {\n            return clearRecords(getWixCacheKeys().filter(function(key) {\n                return !recordUtils.belongsToCurrentUser(key);\n            }));\n        }\n        function clearExpiredRecords() {\n            return clearRecords(getWixCacheKeys().filter(function(cacheKey) {\n                var record = hub._get({\n                    keys: [ cacheKey ]\n                });\n                return recordUtils.isExpired(record);\n            }));\n        }\n        function clearNonExpiredRecord() {\n            var arr = remoteAndAdhocKeys.length === 0 ? dataKeys : remoteAndAdhocKeys;\n            var key = arr.shift();\n            return clearRecord(key);\n        }\n        hub._clear = function(amount) {\n            var requiredSpace = amount || 0;\n            var clearedSpace = 0;\n            clearedSpace += clearOtherUsers();\n            clearedSpace += clearExpiredRecords();\n            var size = getWixCacheSize();\n            var removedRecordsSpace = 0;\n            while (size - removedRecordsSpace > MAX_STORAGE_SIZE_IN_BYTES) {\n                var removed = clearNonExpiredRecord();\n                clearedSpace += removed;\n                removedRecordsSpace += removed;\n            }\n            if (size - removedRecordsSpace < requiredSpace - clearedSpace) {\n                return false;\n            }\n            while (clearedSpace < requiredSpace) {\n                clearedSpace += clearNonExpiredRecord();\n            }\n            return true;\n        };\n        hub.init = decorateInit;\n        hub._set = decorateSet;\n        hub.init([ {\n            origin: /\\.(wix|wixpress)\\.com($|:\\d{4}$)/,\n            allow: [ \"get\", \"set\", \"del\" ]\n        }, {\n            origin: /localhost:\\d{4}$/,\n            allow: [ \"get\", \"set\", \"del\" ]\n        } ]);\n    }\n    crossStorageCleanerFactory.$inject = [ \"$window\", \"$interval\", \"recordUtils\", \"MAX_STORAGE_SIZE_IN_BYTES\", \"CLEANING_INTERVAL\", \"DATA_TYPE\" ];\n    angular.module(\"wixAngularStorageHub\").run(crossStorageCleanerFactory);\n})();\n\n\"use strict\";\n\n(function() {\n    function wixStorageFactory($q, $http, recordUtils, wixCache, wixAngularStorageErrors, ANGULAR_STORAGE_PREFIX, REMOTE_TYPE, DEFAULT_AGE_IN_SEC) {\n        var wixStorage = {};\n        function cacheRemoteData(key, data, options) {\n            if (!options.noCache) {\n                return wixCache.set(key, data, angular.extend({}, options, {\n                    type: REMOTE_TYPE,\n                    expiration: DEFAULT_AGE_IN_SEC\n                }));\n            }\n        }\n        function getRemote(key, options) {\n            var path = options.siteId ? \"getVolatilePrefForSite\" : \"getVolatilePrefForKey\";\n            var url = [ \"/_api/wix-user-preferences-webapp\", path, ANGULAR_STORAGE_PREFIX, options.siteId, key ].filter(angular.identity).join(\"/\");\n            return $http.get(url).then(function(res) {\n                if (res.data[key] === null) {\n                    return $q.reject(wixAngularStorageErrors.NOT_FOUND);\n                }\n                cacheRemoteData(key, res.data[key], options);\n                return res.data[key];\n            }, function(err) {\n                if (err.status === 404) {\n                    cacheRemoteData(key, null, options);\n                    return $q.reject(wixAngularStorageErrors.NOT_FOUND);\n                }\n                return $q.reject(wixAngularStorageErrors.SERVER_ERROR);\n            });\n        }\n        function tryCache(key, options) {\n            return wixCache.get(key, options).then(function(res) {\n                if (res === null) {\n                    return $q.reject(wixAngularStorageErrors.NOT_FOUND);\n                }\n                return res;\n            }, function() {\n                return getRemote(key, options);\n            });\n        }\n        wixStorage.set = function(key, data, opts) {\n            var options = opts || {};\n            recordUtils.validateKey(key);\n            recordUtils.validateData(data);\n            recordUtils.validateExpiration(options);\n            var dto = {\n                nameSpace: ANGULAR_STORAGE_PREFIX,\n                key: key,\n                blob: data\n            };\n            if (options.siteId) {\n                dto.siteId = options.siteId;\n            }\n            if (options.expiration) {\n                dto.TTLInDays = Math.ceil(options.expiration / (60 * 60 * 24));\n            }\n            return $http.post(\"/_api/wix-user-preferences-webapp/set\", dto).then(function() {\n                cacheRemoteData(key, data, options);\n                return key;\n            });\n        };\n        wixStorage.get = function(key, opts) {\n            var options = opts || {};\n            return !options.noCache ? tryCache(key, options) : getRemote(key, options);\n        };\n        wixStorage.remove = function(key, opts) {\n            return wixStorage.set(key, null, opts);\n        };\n        if (!recordUtils.isUserLoggedIn()) {\n            wixStorage.set = wixStorage.get = wixStorage.remove = function() {\n                return $q.reject(wixAngularStorageErrors.LOGGED_OUT);\n            };\n        }\n        return wixStorage;\n    }\n    wixStorageFactory.$inject = [ \"$q\", \"$http\", \"recordUtils\", \"wixCache\", \"wixAngularStorageErrors\", \"ANGULAR_STORAGE_PREFIX\", \"REMOTE_TYPE\", \"DEFAULT_AGE_IN_SEC\" ];\n    angular.module(\"wixAngularStorage\").factory(\"wixStorage\", wixStorageFactory);\n})();\n\n\"use strict\";\n\n(function() {\n    function recordUtilsFactory(wixCookies, ANGULAR_STORAGE_PREFIX, KEY_SEPARATOR, MAX_KEY_LENGTH, MAX_VALUE_SIZE_IN_BYTES, MAX_AGE_IN_SEC) {\n        var recordUtils = {};\n        function countBytes(str) {\n            return encodeURI(str).match(/%..|./g).length;\n        }\n        function hasExpiration(options) {\n            return options && !!options.expiration;\n        }\n        recordUtils.isUserLoggedIn = function() {\n            return wixCookies.userGUID !== undefined;\n        };\n        recordUtils.validateKey = function(key) {\n            if (typeof key !== \"string\" || key.length > MAX_KEY_LENGTH) {\n                throw new Error(\"Key length should be no more than \" + MAX_KEY_LENGTH + \" chars\");\n            }\n        };\n        recordUtils.validateData = function(data) {\n            var val = JSON.stringify(data);\n            if (countBytes(val) > MAX_VALUE_SIZE_IN_BYTES) {\n                throw new Error(\"The size of passed data exceeds the allowed \" + MAX_VALUE_SIZE_IN_BYTES / 1024 + \" KB\");\n            }\n        };\n        recordUtils.validateExpiration = function(options) {\n            if (hasExpiration(options) && (typeof options.expiration !== \"number\" || options.expiration > MAX_AGE_IN_SEC)) {\n                throw new Error(\"Expiration should be a number and cannot increase \" + MAX_AGE_IN_SEC + \" seconds\");\n            }\n        };\n        recordUtils.isExpired = function(record) {\n            if (hasExpiration(record.options)) {\n                return record.createdAt + record.options.expiration * 1e3 <= Date.now();\n            } else {\n                return false;\n            }\n        };\n        recordUtils.getRecordSize = function(key, value) {\n            return countBytes(key) + countBytes(JSON.stringify(value));\n        };\n        recordUtils.getCacheKey = function(key, opts) {\n            var options = opts || {};\n            return [ ANGULAR_STORAGE_PREFIX, wixCookies.userGUID, options.siteId, key ].filter(angular.identity).join(KEY_SEPARATOR);\n        };\n        recordUtils.generateRandomKey = function() {\n            return Math.random().toString(36).slice(2);\n        };\n        recordUtils.hasPrefix = function(key) {\n            return key.indexOf(ANGULAR_STORAGE_PREFIX) === 0;\n        };\n        recordUtils.belongsToCurrentUser = function(key) {\n            if (recordUtils.isUserLoggedIn()) {\n                return key.split(KEY_SEPARATOR)[1] === wixCookies.userGUID;\n            } else {\n                return false;\n            }\n        };\n        return recordUtils;\n    }\n    recordUtilsFactory.$inject = [ \"wixCookies\", \"ANGULAR_STORAGE_PREFIX\", \"KEY_SEPARATOR\", \"MAX_KEY_LENGTH\", \"MAX_VALUE_SIZE_IN_BYTES\", \"MAX_AGE_IN_SEC\" ];\n    angular.module(\"wixAngularStorage\").factory(\"recordUtils\", recordUtilsFactory);\n})();\n\n\"use strict\";\n\n(function() {\n    function WixAngularTopology($sceDelegateProvider) {\n        var staticsUrl = \"\";\n        this.getStaticsUrl = function() {\n            return staticsUrl;\n        };\n        this.setStaticsUrl = function(url) {\n            staticsUrl = url && url.replace(/\\/?$/, \"/\").replace(/^\\/\\//, location.protocol + \"//\");\n            $sceDelegateProvider.resourceUrlWhitelist([ staticsUrl + \"**\", \"self\" ]);\n        };\n        this.$get = [ \"$window\", \"$document\", \"$location\", \"$injector\", function($window, $document, $location, $injector) {\n            var origin = $document.find && $document.find(\"base\").attr(\"href\") ? $window.location.protocol + \"//\" + $window.location.host : \"\";\n            function fixOrigin(url) {\n                return url.replace(/^([^\\/]*\\/\\/+)?[^\\/]*/, origin);\n            }\n            var wixAngularTopology = {};\n            wixAngularTopology.fixOrigin = fixOrigin;\n            wixAngularTopology.calcPartialsUrl = function(staticsUrl, force) {\n                if (!force && $location.protocol && $location.protocol() === \"https\" && $injector.has(\"experimentManager\") && $injector.get(\"experimentManager\").isExperimentEnabled(\"specs.cx.UseCorsInPartials\")) {\n                    return staticsUrl;\n                } else {\n                    return staticsUrl ? fixOrigin(staticsUrl.replace(\"/services/\", \"/_partials/\")) : \"\";\n                }\n            };\n            wixAngularTopology.staticsUrl = staticsUrl ? staticsUrl : \"\";\n            wixAngularTopology.partialsUrl = staticsUrl ? fixOrigin(staticsUrl.replace(\"/services/\", \"/_partials/\")) : \"\";\n            return wixAngularTopology;\n        } ];\n        this.$get.$inject = [ \"$window\", \"$document\", \"$location\", \"$injector\" ];\n    }\n    WixAngularTopology.$inject = [ \"$sceDelegateProvider\" ];\n    angular.module(\"wixAngularAppInternal\").provider(\"wixAngularTopology\", WixAngularTopology);\n})();\n\n\"use strict\";\n\nwindow.jsonpExperiemts = {};\n\nwindow.loadExperimentScopeSync = function(scope) {\n    var url = \"//www.wix.com/_api/wix-laboratory-server/laboratory/conductAllInScope?scope=\" + scope + \"&accept=jsonp&callback=setExperimentsSync\";\n    document.write('<script src=\"' + url + '\"></script>');\n    window.setExperimentsSync = function(junk, experiments) {\n        angular.extend(window.jsonpExperiemts, experiments);\n    };\n};\n\nvar ExperimentManager = function() {\n    function ExperimentManager(provider, $http) {\n        this.provider = provider;\n        this.$http = $http;\n        this.petriUrlPrefix = \"/_api/wix-laboratory-server/laboratory/\";\n        this.getExperimentValue = provider.getExperimentValue.bind(provider);\n        this.isExperimentEnabled = provider.isExperimentEnabled.bind(provider);\n    }\n    ExperimentManager.$inject = [ \"provider\", \"$http\" ];\n    ExperimentManager.prototype.get = function(value) {\n        return this.getExperimentValue(value);\n    };\n    ExperimentManager.prototype.contains = function(value) {\n        return this.isExperimentEnabled(value);\n    };\n    ExperimentManager.prototype.loadScope = function(scope) {\n        var _this = this;\n        return this.$$queryPetri({\n            scope: scope\n        }).then(function(experiments) {\n            _this.provider.setExperiments(experiments);\n            return experiments;\n        });\n    };\n    ExperimentManager.prototype.loadExperiment = function(name, fallback) {\n        var _this = this;\n        return this.$$queryPetri({\n            name: name,\n            fallback: fallback\n        }).then(function(value) {\n            var singleExperiment = {};\n            singleExperiment[name] = value;\n            _this.provider.setExperiments(singleExperiment);\n            return value;\n        });\n    };\n    ExperimentManager.prototype.$$queryPetri = function(params) {\n        return this.$http.get(this.getPetriUrl(params), {\n            params: this.getQueryParams(params),\n            cache: true\n        }).then(function(result) {\n            return result.data;\n        });\n    };\n    ExperimentManager.prototype.$$getExperimentsObj = function() {\n        return this.provider.experiments;\n    };\n    ExperimentManager.prototype.getPetriUrl = function(params) {\n        return this.petriUrlPrefix + (params.scope ? \"conductAllInScope/\" : \"conductExperiment/\");\n    };\n    ExperimentManager.prototype.getQueryParams = function(params) {\n        return params.scope ? {\n            scope: params.scope\n        } : {\n            key: params.name,\n            fallback: params.fallback\n        };\n    };\n    return ExperimentManager;\n}();\n\nvar ExperimentManagerProvider = function() {\n    function ExperimentManagerProvider() {\n        this.experiments = angular.copy(window.jsonpExperiemts);\n    }\n    ExperimentManagerProvider.prototype.clearExperiments = function() {\n        this.experiments = {};\n    };\n    ExperimentManagerProvider.prototype.isExperimentEnabled = function(name) {\n        return this.experiments[name] === \"true\";\n    };\n    ExperimentManagerProvider.prototype.setExperiments = function(map) {\n        angular.extend(this.experiments, map);\n    };\n    ExperimentManagerProvider.prototype.getExperimentValue = function(name) {\n        return this.experiments[name];\n    };\n    ExperimentManagerProvider.prototype.$get = function($injector) {\n        return $injector.instantiate(ExperimentManager, {\n            provider: this\n        });\n    };\n    ExperimentManagerProvider.prototype.$get.$inject = [ \"$injector\" ];\n    return ExperimentManagerProvider;\n}();\n\nangular.module(\"wixAngularExperiments\").provider(\"experimentManager\", ExperimentManagerProvider).run([ \"$rootScope\", \"experimentManager\", function($rootScope, experimentManager) {\n    $rootScope.experimentManager = experimentManager;\n} ]);\n\n\"use strict\";\n\nif (window.beforeEach) {\n    window.beforeEach(function() {\n        angular.module(\"experimentManagerMock\").config([ \"experimentManagerProvider\", function(experimentManagerProvider) {\n            experimentManagerProvider.clearExperiments();\n        } ]);\n    });\n}\n\nangular.module(\"experimentManagerMock\", []).config([ \"$provide\", function($provide) {\n    $provide.decorator(\"experimentManager\", [ \"$delegate\", \"$q\", function($delegate, $q) {\n        var originalGetExperimentValue = $delegate.getExperimentValue.bind($delegate);\n        var originalIsExperimentEnabled = $delegate.isExperimentEnabled.bind($delegate);\n        var scopeToExperiments = {};\n        var unexpected = [];\n        var used = [];\n        function addIfNotExist(val, group) {\n            if (group.indexOf(val) === -1) {\n                group.push(val);\n            }\n        }\n        function markAsUsedOrUnexpected(experiment) {\n            if (originalGetExperimentValue(experiment) === undefined) {\n                addIfNotExist(experiment, unexpected);\n            } else {\n                addIfNotExist(experiment, used);\n            }\n        }\n        function resolvePromise(params) {\n            var deferred = $q.defer();\n            if (params.scope) {\n                deferred.resolve(scopeToExperiments[params.scope] || {});\n            } else {\n                deferred.resolve(Object.keys(scopeToExperiments).reduce(function(prev, scope) {\n                    return prev || scopeToExperiments[scope][params.name];\n                }, undefined) || params.fallback);\n            }\n            return deferred.promise;\n        }\n        $delegate.getExperimentValue = function(name) {\n            markAsUsedOrUnexpected(name);\n            return originalGetExperimentValue(name);\n        };\n        $delegate.isExperimentEnabled = function(name) {\n            markAsUsedOrUnexpected(name);\n            return originalIsExperimentEnabled(name);\n        };\n        $delegate.$$queryPetri = function(params) {\n            return $q.when(params).then(resolvePromise);\n        };\n        $delegate.setScopeExperiments = function(str, map) {\n            scopeToExperiments[str] = map;\n        };\n        $delegate.verifyNoUnexpectedExperiments = function() {\n            if (unexpected.length) {\n                throw \"unexpected experiments: \" + unexpected.join(\", \");\n            }\n        };\n        $delegate.verifyNoUnusedExperiments = function() {\n            var unused = Object.keys($delegate.$$getExperimentsObj()).filter(function(experiment) {\n                return used.indexOf(experiment) === -1;\n            });\n            if (unused.length) {\n                throw \"unused experiments: \" + unused.join(\", \");\n            }\n        };\n        return $delegate;\n    } ]);\n} ]);\n\n\"use strict\";\n\nvar PermissionsManager = function() {\n    function PermissionsManager(provider) {\n        this.provider = provider;\n    }\n    PermissionsManager.$inject = [ \"provider\" ];\n    PermissionsManager.prototype.contains = function(value) {\n        return this.getIndexOf(value) !== -1;\n    };\n    PermissionsManager.prototype.get = function(value) {\n        return this.contains(value).toString();\n    };\n    PermissionsManager.prototype.loadScope = function(scope) {\n        throw new Error(\"This method is not implemented.\");\n    };\n    PermissionsManager.prototype.getIndexOf = function(value) {\n        return this.provider.permissions.indexOf(value);\n    };\n    return PermissionsManager;\n}();\n\nvar PermissionsManagerProvider = function() {\n    function PermissionsManagerProvider() {\n        this.permissions = [];\n    }\n    PermissionsManagerProvider.prototype.setPermissions = function(permissions) {\n        this.permissions = permissions;\n    };\n    PermissionsManagerProvider.prototype.clearPermissions = function() {\n        angular.copy([], this.permissions);\n    };\n    PermissionsManagerProvider.prototype.$get = function($injector) {\n        return $injector.instantiate(PermissionsManager, {\n            provider: this\n        });\n    };\n    PermissionsManagerProvider.prototype.$get.$inject = [ \"$injector\" ];\n    return PermissionsManagerProvider;\n}();\n\nangular.module(\"wixAngularPermissions\").provider(\"permissionsManager\", PermissionsManagerProvider);\n//# sourceMappingURL=wix-angular.js.map\n\"use strict\";\n\nangular.module(\"wix.common.bi\", []).factory(\"Logger\", function() {\n    return W.BI.Logger;\n}).factory(\"DomEventHandler\", function() {\n    return W.BI.DomEventHandler;\n});\n\n\"use strict\";\n\nvar W = W || {};\n\nW.BI = W.BI || {};\n\nW.BI.ErrorSeverity = {\n    RECOVERABLE: 10,\n    WARNING: 20,\n    ERROR: 30,\n    FATAL: 40\n};\n\nW.BI.Categories = {\n    EDITOR: 1,\n    VIEWER: 2,\n    TIMEOUTS: 3,\n    SERVER: 4\n};\n\nW.BI.Logger = function() {\n    function now() {\n        return new Date().getTime();\n    }\n    var startTime = now();\n    var defaultEventArgs = {\n        _: now\n    };\n    var defaultErrorArgs = {\n        _: now,\n        ts: function() {\n            return now() - startTime;\n        },\n        cat: W.BI.Categories.VIEWER,\n        sev: W.BI.ErrorSeverity.WARNING,\n        iss: 1,\n        ver: \"1\"\n    };\n    var _initOptions = {\n        hostName: \"frog.wix.com\",\n        defaultEventArgs: {},\n        defaultErrorArgs: {},\n        biUrl: \"//frog.wix.com/\",\n        adapter: \"\",\n        error: function(str) {\n            throw str;\n        }\n    };\n    var EVENT_IDS = {\n        ERROR: 10,\n        ON_READY: 302,\n        ROUTE_CHANGE: 300\n    };\n    function _extend(dst) {\n        for (var i = 1; i < arguments.length; i++) {\n            var extending = arguments[i];\n            if (extending) {\n                for (var key in extending) {\n                    dst[key] = extending[key];\n                }\n            }\n        }\n        return dst;\n    }\n    function biLogger(args) {\n        var _lastBiUrl = {\n            url: undefined,\n            assertEmpty: function() {\n                if (this.url !== undefined) {\n                    throw \"last bi is not empty!!!\";\n                }\n            },\n            resolve: function() {\n                this.callback();\n            },\n            clear: function() {\n                this.url = undefined;\n            }\n        };\n        var _options;\n        var fieldParsers = new W.BI.FieldParsers(args.injector);\n        if (args.hostName) {\n            args.biUrl = \"//\" + args.hostName + \"/\";\n        }\n        _options = _extend({}, _initOptions, args);\n        function _log(eventArgs, callback) {\n            var _biFieldsRestrictions = {\n                src: {\n                    type: \"number\"\n                },\n                evid: {\n                    type: \"number\"\n                }\n            };\n            var eventParams = _extend({}, defaultEventArgs, _options.defaultEventArgs, eventArgs);\n            if (_validateBiEventArgs(eventParams, [ \"evid\" ], _biFieldsRestrictions)) {\n                _sendBiEvent(eventParams, callback);\n            }\n        }\n        function _error(errorArgs, callback) {\n            var _requiredErrorFields = [ \"evid\", \"cat\", \"iss\", \"sev\", \"errc\", \"ver\" ];\n            var _errorFieldsRestrictions = {\n                src: {\n                    type: \"number\"\n                },\n                evid: {\n                    type: \"number\",\n                    values: [ EVENT_IDS.ERROR ]\n                },\n                cat: {\n                    type: \"number\",\n                    values: [ W.BI.Categories.EDITOR, W.BI.Categories.VIEWER, W.BI.Categories.TIMEOUTS, W.BI.Categories.SERVER ]\n                },\n                iss: {\n                    type: \"number\"\n                },\n                sev: {\n                    type: \"number\",\n                    values: [ W.BI.ErrorSeverity.RECOVERABLE, W.BI.ErrorSeverity.WARNING, W.BI.ErrorSeverity.ERROR, W.BI.ErrorSeverity.FATAL ]\n                },\n                errc: {\n                    type: \"number\"\n                },\n                httpc: {\n                    type: \"number\"\n                },\n                ver: {\n                    type: \"string\",\n                    maxLength: 16\n                },\n                errscp: {\n                    type: \"string\",\n                    subStr: 64\n                },\n                trgt: {\n                    type: \"string\",\n                    subStr: 64\n                },\n                gsi: {\n                    type: \"string\",\n                    length: 36\n                },\n                ts: {\n                    type: \"number\"\n                },\n                uid: {\n                    type: \"number\"\n                },\n                ut: {\n                    type: \"string\",\n                    maxLength: 16\n                },\n                did: {\n                    type: \"string\",\n                    maxLength: 36\n                },\n                cid: {\n                    type: \"string\",\n                    length: 36\n                },\n                lng: {\n                    type: \"string\",\n                    maxLength: 5\n                },\n                dsc: {\n                    type: \"string\",\n                    subStr: 512\n                }\n            };\n            var errorParams = _extend({}, defaultErrorArgs, _options.defaultErrorArgs, errorArgs, {\n                evid: EVENT_IDS.ERROR\n            });\n            if (_validateBiEventArgs(errorParams, _requiredErrorFields, _errorFieldsRestrictions)) {\n                _sendBiEvent(errorParams, callback);\n            }\n        }\n        function _reportOnReady(viewName, eventArgs, callback) {\n            var _onReadyFieldsRestrictions = {\n                view: {\n                    type: \"string\"\n                }\n            };\n            var eventParams = _extend({}, eventArgs, {\n                evid: EVENT_IDS.ON_READY,\n                view: viewName\n            });\n            if (_validateBiEventArgs(eventParams, [ \"view\" ], _onReadyFieldsRestrictions)) {\n                _log(eventParams, callback);\n            }\n        }\n        function _reportRouteChange(viewName, eventArgs, callback) {\n            var _routeChangeFieldsRestrictions = {\n                view: {\n                    type: \"string\"\n                }\n            };\n            var eventParams = _extend({}, eventArgs, {\n                evid: EVENT_IDS.ROUTE_CHANGE,\n                view: viewName\n            });\n            if (_validateBiEventArgs(eventParams, [ \"view\" ], _routeChangeFieldsRestrictions)) {\n                _log(eventParams, callback);\n            }\n        }\n        function _validateBiEventArgs(eventArgs, requiredArgs, restrictions) {\n            var missingRequiredArgs = requiredArgs.slice(0);\n            for (var key in eventArgs) {\n                var currentRestrictions = restrictions[key] || {};\n                eventArgs[key] = fieldParsers.parse(eventArgs[key], currentRestrictions);\n                if (!fieldParsers.valid(eventArgs[key], currentRestrictions)) {\n                    _options.error(\"Bad event param (key: \" + key + \", value: \" + eventArgs[key] + \")\");\n                    return;\n                }\n                var missingIndex;\n                if ((missingIndex = missingRequiredArgs.indexOf(key)) > -1) {\n                    missingRequiredArgs.splice(missingIndex, 1);\n                }\n            }\n            if (missingRequiredArgs.length > 0) {\n                _options.error(\"Missing required params: \" + missingRequiredArgs.join(\", \"));\n                return false;\n            }\n            return true;\n        }\n        function _addUrlParams(url, params) {\n            var delimiter = url.match(/\\?./) ? \"&\" : \"?\";\n            return url.replace(/\\?$/, \"\") + delimiter + Object.keys(params).map(function(key) {\n                return [ encodeURIComponent(key), \"=\", encodeURIComponent(params[key]) ].join(\"\");\n            }).join(\"&\");\n        }\n        function _sendBiEvent(eventArgs, callback) {\n            var frogAdapter = eventArgs.adapter || _options.adapter;\n            delete eventArgs.adapter;\n            var url = _addUrlParams(_options.biUrl + frogAdapter, eventArgs);\n            var biImage = new Image(0, 0);\n            var onComplete = callback || function() {};\n            biImage.onload = onComplete;\n            biImage.onerror = onComplete;\n            biImage.src = url;\n            _lastBiUrl.url = url;\n            _lastBiUrl.callback = callback;\n        }\n        return {\n            log: _log,\n            reportOnReady: _reportOnReady,\n            reportRouteChange: _reportRouteChange,\n            error: _error,\n            getLastBiUrl: function() {\n                return _lastBiUrl;\n            }\n        };\n    }\n    return biLogger;\n}();\n\n\"use strict\";\n\nvar W = W || {};\n\nW.BI = W.BI || {};\n\nW.BI.DomEventHandler = function() {\n    var _wixBiAttributeSelector = \"wix-bi\", _wixBiArgsAttribute = \"wix-bi-args\", _initOptions = {\n        eventMap: {},\n        errorMap: {},\n        error: function(str) {\n            throw str;\n        }\n    };\n    function _extend(dst) {\n        for (var i = 1; i < arguments.length; i++) {\n            var extending = arguments[i];\n            if (extending) {\n                for (var key in extending) {\n                    dst[key] = extending[key];\n                }\n            }\n        }\n        return dst;\n    }\n    function eventHandler(biLogger, args) {\n        var _options;\n        var _biLogger = biLogger;\n        _options = _extend({}, _initOptions, args);\n        function _safeGetEventParams(eventName, eventMap, explicitParams) {\n            var params;\n            if (!eventMap || !eventMap[eventName]) {\n                _options.error(\"Invalid event name\");\n                params = {};\n            } else {\n                params = eventMap[eventName];\n            }\n            return _extend({}, params, explicitParams);\n        }\n        function _log(eventName, eventArgs, callback) {\n            var eventParams = _safeGetEventParams(eventName, _options.eventMap, eventArgs);\n            _biLogger.log(eventParams, callback);\n        }\n        function _error(errorName, errorArgs, callback) {\n            var errorParams = _safeGetEventParams(errorName, _options.errorMap, errorArgs);\n            _biLogger.error(errorParams, callback);\n        }\n        function _getAttr(element, name) {\n            for (var i = 0; i < element.attributes.length; i++) {\n                if (element.attributes[i].name === name) {\n                    return element.attributes[i].value;\n                }\n            }\n        }\n        function _handleTriggeredBiEvent(event) {\n            var eventName = _getAttr(event.target, _wixBiAttributeSelector);\n            if (eventName) {\n                var eventArgsStr = _getAttr(event.target, _wixBiArgsAttribute);\n                var eventArgs = eventArgsStr ? eval(\"eventArgs = \" + eventArgsStr) : {};\n                _log(eventName, eventArgs);\n            }\n        }\n        function _bind() {\n            document.body.addEventListener(\"click\", _handleTriggeredBiEvent);\n        }\n        function _unbind() {\n            document.body.removeEventListener(\"click\", _handleTriggeredBiEvent);\n        }\n        return {\n            bind: _bind,\n            unbind: _unbind,\n            log: _log,\n            error: _error\n        };\n    }\n    return eventHandler;\n}();\n\n\"use strict\";\n\nvar W = W || {};\n\nW.BI = W.BI || {};\n\nW.BI.FieldParsers = function($injector) {\n    var validators = {\n        length: function(val, length) {\n            return val && val.length !== undefined && val.length === length;\n        },\n        maxLength: function(val, maxLength) {\n            return val && val.length !== undefined && val.length <= maxLength;\n        },\n        values: function(val, values) {\n            return values && values.indexOf(val) !== -1;\n        },\n        type: function(val, type) {\n            return val && typeof val === type;\n        }\n    };\n    var parsers = {\n        subStr: function(val, length) {\n            if (val && val.substr) {\n                return val.substr(0, Math.min(val.length, length));\n            }\n            return val;\n        }\n    };\n    this.valid = function(value, restrictions) {\n        for (var key in restrictions) {\n            if (validators[key] && !validators[key](value, restrictions[key])) {\n                return false;\n            }\n        }\n        return true;\n    };\n    this.parse = function(value, restrictions) {\n        if (typeof value === \"function\") {\n            value = $injector ? $injector.invoke(value) : value();\n        }\n        for (var key in restrictions) {\n            value = parsers[key] ? parsers[key](value, restrictions[key]) : value;\n        }\n        return value;\n    };\n};\n\n\"use strict\";\n\nangular.module(\"wix.common.bi\").directive(\"wixBi\", [ \"domBiLogger\", function(domBiLogger) {\n    function convertAttrToConst(attr) {\n        return attr.replace(/-/g, \"_\").toUpperCase();\n    }\n    return {\n        restrict: \"A\",\n        priority: 1,\n        link: {\n            pre: function(scope, element, attr) {\n                var eventType = attr.wixBiEvent || \"click\";\n                element.bind(eventType, function() {\n                    var eventName = convertAttrToConst(attr.wixBi);\n                    var eventArgs = scope.$eval(attr.wixBiArgs) || {};\n                    domBiLogger.log(eventName, eventArgs);\n                });\n            }\n        }\n    };\n} ]);\n\n\"use strict\";\n\nangular.module(\"wix.common.bi\").provider(\"biLogger\", [ \"recursiveExtend\", function(recursiveExtend) {\n    var _config = {\n        eventMap: {}\n    };\n    this.setConfig = function(config) {\n        recursiveExtend(_config, config);\n    };\n    this.$get = [ \"Logger\", \"$injector\", function(Logger, $injector) {\n        _config.injector = $injector;\n        return angular.extend(new Logger(_config), {\n            getConfig: function() {\n                return _config;\n            }\n        });\n    } ];\n    this.$get.$inject = [ \"Logger\", \"$injector\" ];\n} ]);\n\n\"use strict\";\n\nangular.module(\"wix.common.bi\").provider(\"domBiLogger\", [ \"recursiveExtend\", function(recursiveExtend) {\n    var _config = {\n        eventMap: {}\n    };\n    this.setConfig = function(config) {\n        recursiveExtend(_config, config);\n    };\n    this.$get = [ \"biLogger\", \"DomEventHandler\", function(biLogger, DomEventHandler) {\n        return angular.extend(new DomEventHandler(biLogger, _config), {\n            getConfig: function() {\n                return _config;\n            }\n        });\n    } ];\n    this.$get.$inject = [ \"biLogger\", \"DomEventHandler\" ];\n} ]);\n\n\"use strict\";\n\nangular.module(\"wix.common.bi\").constant(\"recursiveExtend\", function() {\n    function isObject(v) {\n        return v !== null && typeof v === \"object\" && v.constructor !== Array;\n    }\n    function applyModifications(conf, partial) {\n        for (var k in partial) {\n            if (partial.hasOwnProperty(k)) {\n                if (isObject(partial[k])) {\n                    conf[k] = conf[k] || {};\n                    applyModifications(conf[k], partial[k]);\n                } else {\n                    conf[k] = partial[k];\n                }\n            }\n        }\n    }\n    return applyModifications;\n}());\n\n\"use strict\";\n\nangular.module(\"wix.common.bi\").provider(\"wixBiLogger\", [ \"biLoggerProvider\", \"domBiLoggerProvider\", function(biLoggerProvider, domBiLoggerProvider) {\n    this.setConfig = function(config) {\n        biLoggerProvider.setConfig(config);\n        domBiLoggerProvider.setConfig(config);\n    };\n    this.$get = [ \"biLogger\", \"domBiLogger\", \"$q\", \"$rootScope\", \"$window\", function(biLogger, domBiLogger, $q, $rootScope, $window) {\n        var _config = angular.extend({}, biLogger.getConfig(), domBiLogger.getConfig());\n        var reportedToNewRelic = false;\n        function makeCb(defer) {\n            return function() {\n                $rootScope.$apply(function() {\n                    defer.resolve();\n                });\n            };\n        }\n        function getReducedMap(map) {\n            return Object.keys(_config[map] || []).reduce(function(prev, key) {\n                prev[key] = key;\n                return prev;\n            }, {});\n        }\n        function isNewRelicDefined() {\n            return typeof $window.NREUM !== \"undefined\";\n        }\n        return {\n            log: function(eventName, eventArgs) {\n                var defer = $q.defer();\n                if (typeof eventName === \"string\" || !eventName) {\n                    domBiLogger.log(eventName, eventArgs, makeCb(defer));\n                } else {\n                    biLogger.log(eventName, makeCb(defer));\n                }\n                return defer.promise;\n            },\n            error: function(eventName, eventArgs) {\n                var defer = $q.defer();\n                if (typeof eventName === \"string\") {\n                    domBiLogger.error(eventName, eventArgs, makeCb(defer));\n                } else {\n                    biLogger.error(eventName, makeCb(defer));\n                }\n                return defer.promise;\n            },\n            reportOnReady: function(viewName, eventArgs) {\n                var defer = $q.defer();\n                if (!reportedToNewRelic && isNewRelicDefined()) {\n                    $window.NREUM.finished();\n                    reportedToNewRelic = true;\n                }\n                biLogger.reportOnReady(viewName, eventArgs, makeCb(defer));\n                return defer.promise;\n            },\n            reportRouteChange: function(viewName, eventArgs) {\n                var defer = $q.defer();\n                biLogger.reportRouteChange(viewName, eventArgs, makeCb(defer));\n                return defer.promise;\n            },\n            getLastBiUrl: function() {\n                return biLogger.getLastBiUrl();\n            },\n            events: getReducedMap(\"eventMap\"),\n            errors: getReducedMap(\"errorMap\"),\n            getConfig: function() {\n                return angular.extend({}, biLogger.getConfig(), domBiLogger.getConfig());\n            }\n        };\n    } ];\n    this.$get.$inject = [ \"biLogger\", \"domBiLogger\", \"$q\", \"$rootScope\", \"$window\" ];\n} ]);\n//# sourceMappingURL=wix-bi-angular.js.map"]}